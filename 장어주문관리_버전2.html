<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ ì¥ì–´ ì£¼ë¬¸ê´€ë¦¬ ì‹œìŠ¤í…œ - ë²„ì „2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #e8f5e8 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab.active {
            background: #3b82f6;
            color: white;
        }

        .tab:hover:not(.active) {
            background: #f3f4f6;
        }

        .content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 5px;
            font-size: 14px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .btn:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .grid {
            display: grid;
            gap: 15px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #10b981;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #10b981;
        }

        .partner-list {
            margin-top: 20px;
        }

        .partner-item {
            background: #f8fafc;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .calendar-header {
            background: #3b82f6;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-nav {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 4px;
        }

        .calendar-nav:hover {
            background: rgba(255,255,255,0.2);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day-header {
            background: #f8fafc;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            border: 1px solid #e5e7eb;
            font-size: 12px;
            color: #666;
        }

        .calendar-cell {
            padding: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            position: relative;
        }

        .calendar-cell:hover {
            background: #f3f4f6;
        }

        .calendar-cell.selected {
            background: #3b82f6;
            color: white;
        }

        .calendar-cell.today {
            background: #fbbf24;
            color: white;
        }

        .calendar-cell.other-month {
            color: #9ca3af;
            background: #f9fafb;
        }

        .calendar-cell.has-price {
            background: #dcfce7;
        }

        .calendar-cell.has-price.selected {
            background: #3b82f6;
            color: white;
        }

        .price-badge {
            font-size: 10px;
            background: #10b981;
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            margin-top: 2px;
        }

        .calendar-cell.selected .price-badge {
            background: rgba(255,255,255,0.3);
        }

        .price-input-section {
            padding: 20px;
            background: #f8fafc;
            border-top: 1px solid #e5e7eb;
        }

        .partner-info {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .partner-calendar {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-top: 15px;
            overflow: hidden;
        }

        .partner-calendar-header {
            background: #10b981;
            color: white;
            padding: 10px 15px;
            font-weight: 600;
        }

        .partner-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .partner-calendar-cell {
            padding: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            min-height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .partner-calendar-cell:hover {
            background: #f3f4f6;
        }

        .partner-calendar-cell.selected {
            background: #10b981;
            color: white;
        }

        .partner-calendar-cell.has-price {
            background: #dcfce7;
        }

        .partner-calendar-cell.has-price.selected {
            background: #10b981;
            color: white;
        }

        .calendar-price-badge {
            font-size: 9px;
            background: #10b981;
            color: white;
            padding: 1px 3px;
            border-radius: 2px;
            margin-top: 1px;
        }

        .partner-calendar-cell.selected .calendar-price-badge {
            background: rgba(255,255,255,0.3);
        }

        .partner-price-input {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
        }

        .partner-price-input h4 {
            color: #0369a1;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .price-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .price-input-group input {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 12px;
        }

        .price-input-group .btn {
            padding: 6px 12px;
            font-size: 12px;
        }

        .dashboard-calendar {
            margin-top: 10px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            max-height: 300px;
            overflow-y: auto;
        }

        .dashboard-calendar-header {
            background: #10b981;
            color: white;
            padding: 8px 12px;
            font-weight: 600;
            font-size: 12px;
        }

        .dashboard-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .dashboard-calendar-cell {
            padding: 6px;
            text-align: center;
            border: 1px solid #e5e7eb;
            font-size: 10px;
            min-height: 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .dashboard-calendar-cell.has-price {
            background: #dcfce7;
        }

        .dashboard-calendar-cell.other-month {
            color: #9ca3af;
            background: #f9fafb;
        }

        .dashboard-price-badge {
            font-size: 8px;
            background: #10b981;
            color: white;
            padding: 1px 2px;
            border-radius: 2px;
            margin-top: 1px;
        }

        .hide {
            display: none !important;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ ì¥ì–´ ì£¼ë¬¸ê´€ë¦¬ ì‹œìŠ¤í…œ ë²„ì „2</h1>
            <p>íš¨ìœ¨ì ì¸ ì¥ì–´ ê±°ë˜ ê´€ë¦¬ë¥¼ ìœ„í•œ í†µí•© ì†”ë£¨ì…˜ - ê°œì„ ëœ ì§ê´€ì  ì¸í„°í˜ì´ìŠ¤</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab" onclick="showTab('partners')">ğŸ‘¥ ê±°ë˜ì²˜ ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('orders')">ğŸ“¦ ì„ ì£¼ë¬¸ ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('advances')">ğŸ’³ ì™¸ìƒ ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('payments')">ğŸ’° ì§€ë¶ˆ ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('receipts')">ğŸ“¥ ì…ê³  ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('history')">ğŸ“‹ ê±°ë˜ë‚´ì—­í™•ì¸</button>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ -->
        <div id="dashboard" class="content active">
            <div class="stats-grid" id="statsGrid">
                <!-- í†µê³„ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            <div id="partnersList">
                <!-- ê±°ë˜ì²˜ í˜„í™©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ê±°ë˜ì²˜ ê´€ë¦¬ -->
        <div id="partners" class="content">
            <h2>ê±°ë˜ì²˜ ê´€ë¦¬</h2>
            <div class="grid grid-2">
                <div>
                    <h3>ìƒˆ ê±°ë˜ì²˜ ì¶”ê°€</h3>
                    <div class="form-group">
                        <label>ê±°ë˜ì²˜ëª…</label>
                        <input type="text" id="partnerName" placeholder="ê±°ë˜ì²˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì—°ë½ì²˜</label>
                        <input type="text" id="partnerContact" placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <button class="btn" onclick="addPartner()">ê±°ë˜ì²˜ ì¶”ê°€</button>
                </div>
                <div id="partnerManagementList">
                    <!-- ê±°ë˜ì²˜ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì„ ì£¼ë¬¸ ê´€ë¦¬ -->
        <div id="orders" class="content">
            <h2>ì„ ì£¼ë¬¸ ê´€ë¦¬</h2>
            <div class="grid grid-2">
                <div>
                    <h3>ìƒˆ ì„ ì£¼ë¬¸ ì¶”ê°€</h3>
                    <div class="form-group">
                        <label>ê±°ë˜ì²˜</label>
                        <select id="orderPartner" onchange="showPartnerCalendar('order')">
                            <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ë‚ ì§œ</label>
                        <input type="date" id="orderDate" value="">
                    </div>
                    <div class="form-group">
                        <label>ìˆ˜ëŸ‰ (kg)</label>
                        <input type="number" id="orderQuantity" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”" oninput="calculateOrderTotal()">
                    </div>
                    <div class="form-group">
                        <label>ë‹¨ê°€ (ì›/kg)</label>
                        <input type="number" id="orderPrice" placeholder="ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" oninput="calculateOrderTotal()">
                    </div>
                    <div class="form-group">
                        <label>ì´ì•¡</label>
                        <input type="text" id="orderTotal" readonly style="background-color: #f3f4f6; font-weight: bold;" placeholder="ìˆ˜ëŸ‰ê³¼ ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ë©´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤">
                    </div>
                    <div class="form-group">
                        <label>ë©”ëª¨</label>
                        <textarea id="orderMemo" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <button class="btn" onclick="addOrder()">ì„ ì£¼ë¬¸ ì¶”ê°€</button>
                    <div id="orderPartnerCalendar" class="partner-calendar" style="display: none;">
                        <!-- ê±°ë˜ì²˜ë³„ ë‹¬ë ¥ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                <div id="ordersList">
                    <!-- ì„ ì£¼ë¬¸ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì™¸ìƒ ê´€ë¦¬ -->
        <div id="advances" class="content">
            <h2>ì™¸ìƒ ê´€ë¦¬</h2>
            <div class="grid grid-2">
                <div>
                    <h3>ìƒˆ ì™¸ìƒ ì¶”ê°€</h3>
                    <div class="form-group">
                        <label>ê±°ë˜ì²˜</label>
                        <select id="advancePartner">
                            <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ë‚ ì§œ</label>
                        <input type="date" id="advanceDate" value="">
                    </div>
                    <div class="form-group">
                        <label>ì™¸ìƒê¸ˆì•¡ (ì›)</label>
                        <input type="number" id="advanceAmount" placeholder="ì™¸ìƒê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ë©”ëª¨</label>
                        <textarea id="advanceMemo" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanceHidden"> ëŒ€ì‹œë³´ë“œì—ì„œ ìˆ¨ê¸°ê¸°
                        </label>
                    </div>
                    <button class="btn" onclick="addAdvance()">ì™¸ìƒ ì¶”ê°€</button>
                </div>
                <div id="advancesList">
                    <!-- ì™¸ìƒ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì§€ë¶ˆ ê´€ë¦¬ -->
        <div id="payments" class="content">
            <h2>ì§€ë¶ˆ ê´€ë¦¬</h2>
            <div class="grid grid-2">
                <div>
                    <h3>ìƒˆ ì§€ë¶ˆ ì¶”ê°€</h3>
                    <div class="form-group">
                        <label>ê±°ë˜ì²˜</label>
                        <select id="paymentPartner" onchange="showPartnerInfo('payment')">
                            <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div id="paymentPartnerInfo" class="partner-info" style="display: none;">
                        <!-- ê±°ë˜ì²˜ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="form-group">
                        <label>ë‚ ì§œ</label>
                        <input type="date" id="paymentDate" value="">
                    </div>
                    <div class="form-group">
                        <label>ì…ê¸ˆì•¡ (ì›)</label>
                        <input type="number" id="paymentAmount" placeholder="ì…ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ë©”ëª¨</label>
                        <textarea id="paymentMemo" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <button class="btn" onclick="addPayment()">ì…ê¸ˆ ì¶”ê°€</button>
                </div>
                <div id="paymentsList">
                    <!-- ì…ê¸ˆ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì…ê³  ê´€ë¦¬ -->
        <div id="receipts" class="content">
            <h2>ì…ê³  ê´€ë¦¬</h2>
            <div class="grid grid-2">
                <div>
                    <h3>ìƒˆ ì…ê³  ì¶”ê°€</h3>
                    <div class="form-group">
                        <label>ê±°ë˜ì²˜</label>
                        <select id="receiptPartner" onchange="showPartnerInfo('receipt')">
                            <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div id="receiptPartnerInfo" class="partner-info" style="display: none;">
                        <!-- ê±°ë˜ì²˜ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="form-group">
                        <label>ë‚ ì§œ</label>
                        <input type="date" id="receiptDate" value="">
                    </div>
                    <div class="form-group">
                        <label>ìˆ˜ëŸ‰ (kg)</label>
                        <input type="number" id="receiptQuantity" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ë©”ëª¨</label>
                        <textarea id="receiptMemo" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <button class="btn" onclick="addReceipt()">ì…ê³  ì¶”ê°€</button>
                </div>
                <div id="receiptsList">
                    <!-- ì…ê³  ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ê±°ë˜ë‚´ì—­ í™•ì¸ -->
        <div id="history" class="content">
            <h2>ê±°ë˜ë‚´ì—­ í™•ì¸</h2>
            <div class="form-group">
                <label>ê±°ë˜ì²˜ í•„í„°</label>
                <select id="historyFilter">
                    <option value="">ì „ì²´ ê±°ë˜ì²˜</option>
                </select>
            </div>
            <button class="btn" onclick="exportData()">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
            <div id="historyList">
                <!-- ê±°ë˜ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let partners = JSON.parse(localStorage.getItem('eelData_partners') || '[]');
        let orders = JSON.parse(localStorage.getItem('eelData_orders') || '[]');
        let advances = JSON.parse(localStorage.getItem('eelData_advances') || '[]');
        let payments = JSON.parse(localStorage.getItem('eelData_payments') || '[]');
        let receipts = JSON.parse(localStorage.getItem('eelData_receipts') || '[]');
        let partnerPrices = JSON.parse(localStorage.getItem('eelData_partnerPrices') || '{}');

        // ë‹¬ë ¥ ê´€ë ¨ ë³€ìˆ˜
        let currentCalendarDate = new Date();
        let selectedCalendarDate = new Date();
        let currentCalendarPartner = null;

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ê³¼ ì½˜í…ì¸  í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // í•´ë‹¹ íƒ­ì˜ ë°ì´í„° ê°±ì‹ 
            if (tabName === 'dashboard') updateDashboard();
            else if (tabName === 'partners') updatePartnersList();
            else if (tabName === 'orders') updateOrdersList();
            else if (tabName === 'advances') updateAdvancesList();
            else if (tabName === 'payments') updatePaymentsList();
            else if (tabName === 'receipts') updateReceiptsList();
            else if (tabName === 'history') updateHistoryList();
            
            // ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì—…ë°ì´íŠ¸
            updateSelects();
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            localStorage.setItem('eelData_partners', JSON.stringify(partners));
            localStorage.setItem('eelData_orders', JSON.stringify(orders));
            localStorage.setItem('eelData_advances', JSON.stringify(advances));
            localStorage.setItem('eelData_payments', JSON.stringify(payments));
            localStorage.setItem('eelData_receipts', JSON.stringify(receipts));
            localStorage.setItem('eelData_partnerPrices', JSON.stringify(partnerPrices));
        }

        // ID ìƒì„±
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(date) {
            return new Date(date).toLocaleDateString('ko-KR');
        }

        // ìˆ«ì í¬ë§·íŒ…
        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(num);
        }

        // ì´ì•¡ ìë™ ê³„ì‚° (ì„ ì£¼ë¬¸)
        function calculateOrderTotal() {
            const quantity = parseFloat(document.getElementById('orderQuantity').value) || 0;
            const price = parseFloat(document.getElementById('orderPrice').value) || 0;
            const total = quantity * price;
            
            const totalField = document.getElementById('orderTotal');
            if (total > 0) {
                totalField.value = formatNumber(total) + 'ì›';
            } else {
                totalField.value = '';
            }
        }

        // ê±°ë˜ì²˜ ì¶”ê°€
        function addPartner() {
            const name = document.getElementById('partnerName').value.trim();
            const contact = document.getElementById('partnerContact').value.trim();
            
            if (!name) {
                alert('ê±°ë˜ì²˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const partner = {
                id: generateId(),
                name: name,
                contact: contact,
                createdAt: new Date().toISOString()
            };
            
            partners.push(partner);
            saveData();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('partnerName').value = '';
            document.getElementById('partnerContact').value = '';
            
            updatePartnersList();
            updateSelects();
            updateDashboard();
            alert('ê±°ë˜ì²˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì´ˆê¸° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            // ë‚ ì§œ í•„ë“œ ì´ˆê¸°í™” (ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •)
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('orderDate').value = today;
            document.getElementById('advanceDate').value = today;
            document.getElementById('paymentDate').value = today;
            document.getElementById('receiptDate').value = today;
            
            updateDashboard();
            updateSelects();
        });

        // ì„ì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤ (ì¶”í›„ êµ¬í˜„)
        function updateDashboard() {
            updateStats();
            updatePartnersDashboard();
        }
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const statsContainer = document.getElementById('statsGrid');
            if (!statsContainer) return;
            
            // ê¸°ë³¸ í†µê³„ ê³„ì‚°
            const totalPartners = partners.length;
            const totalOrders = orders.length;
            const totalPayments = payments.length;
            const totalReceipts = receipts.length;
            
            // í‘œì‹œë˜ëŠ” ì™¸ìƒë§Œ ê³„ì‚° (hiddenì´ falseì´ê±°ë‚˜ undefinedì¸ ê²ƒë“¤)
            const visibleAdvances = advances.filter(a => a.hidden !== true);
            const totalVisibleAdvances = visibleAdvances.length;
            const totalAdvanceAmount = visibleAdvances.reduce((sum, a) => sum + (a.amount || 0), 0);
            
            // ì´ ì„ ì£¼ë¬¸ ê¸ˆì•¡
            const totalOrderAmount = orders.reduce((sum, o) => sum + (o.totalAmount || 0), 0);
            
            // ì´ ì§€ë¶ˆ ê¸ˆì•¡ (ë‚´ê°€ ì§€ë¶ˆí•œ ëˆ)
            const totalPaymentAmount = payments.reduce((sum, p) => sum + (p.amount || 0), 0);
            
            // ì´ ì…ê³  ìˆ˜ëŸ‰ (ë‚´ê°€ ë°›ì€ ì¥ì–´)
            const totalReceiptQuantity = receipts.reduce((sum, r) => sum + (r.quantity || 0), 0);
            
            // ì´ ì¤„ ëˆ (ë‚´ê°€ ì§€ë¶ˆí•´ì•¼ í•  ëˆ: ì„ ì£¼ë¬¸ + ì™¸ìƒ - ì§€ë¶ˆì™„ë£Œ)
            const totalAmountToPay = totalOrderAmount + totalAdvanceAmount - totalPaymentAmount;
            
            // ì´ ë°›ì„ ì¥ì–´ (ë‚´ê°€ ë°›ì•„ì•¼ í•  ì¥ì–´: ì„ ì£¼ë¬¸ ìˆ˜ëŸ‰ - ì…ê³ ì™„ë£Œ)
            const totalOrderQuantity = orders.reduce((sum, o) => sum + (o.quantity || 0), 0);
            const totalEelToReceive = totalOrderQuantity - totalReceiptQuantity;
            
            console.log('ëŒ€ì‹œë³´ë“œ í†µê³„:', {
                totalPartners,
                totalOrders,
                totalVisibleAdvances,
                totalAdvanceAmount,
                totalOrderAmount,
                totalPaymentAmount,
                totalReceiptQuantity,
                totalAmountToPay,
                totalEelToReceive
            });
            
            statsContainer.innerHTML = `
                <div class="stat-card" style="border-left-color: #ef4444;">
                    <div class="stat-number" style="color: #ef4444;">${formatNumber(totalAmountToPay)}ì›</div>
                    <div>ğŸ’° ì´ ì¤„ ëˆ</div>
                </div>
                <div class="stat-card" style="border-left-color: #10b981;">
                    <div class="stat-number" style="color: #10b981;">${formatNumber(totalEelToReceive)}kg</div>
                    <div>ğŸ ì´ ë°›ì„ ì¥ì–´</div>
                </div>
                <div class="stat-card" style="border-left-color: #f59e0b;">
                    <div class="stat-number" style="color: #f59e0b;">${formatNumber(totalAdvanceAmount)}ì›</div>
                    <div>âš ï¸ ì´ ì™¸ìƒ (${totalVisibleAdvances}ê±´)</div>
                </div>
                <div class="stat-card" style="border-left-color: #3b82f6;">
                    <div class="stat-number" style="color: #3b82f6;">${totalPartners}</div>
                    <div>ğŸ‘¥ ì´ ê±°ë˜ì²˜</div>
                </div>
            `;
        }
        
        // ëŒ€ì‹œë³´ë“œ ê±°ë˜ì²˜ í˜„í™©
        function updatePartnersDashboard() {
            const container = document.getElementById('partnersList');
            if (!container) return;
            
            container.innerHTML = '<h3>ğŸ¢ ì£¼ìš” ê±°ë˜ì²˜ í˜„í™©</h3>';
            
            if (partners.length === 0) {
                container.innerHTML += '<p>ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ê±°ë˜ì²˜ë³„ ë°ì´í„° ê³„ì‚° ë° ì •ë ¬
            const partnerData = partners.map(partner => {
                // í•´ë‹¹ ê±°ë˜ì²˜ì˜ í‘œì‹œë˜ëŠ” ì™¸ìƒê¸ˆì•¡ ê³„ì‚°
                const partnerAdvances = advances.filter(a => a.partnerId === partner.id && a.hidden !== true);
                const totalAdvanceAmount = partnerAdvances.reduce((sum, a) => sum + (a.amount || 0), 0);
                
                // í•´ë‹¹ ê±°ë˜ì²˜ì˜ ì„ ì£¼ë¬¸ ê¸ˆì•¡ ë° ìˆ˜ëŸ‰ (ë‚´ê°€ ì¤„ ëˆ, ë‚´ê°€ ë°›ì„ ì¥ì–´)
                const partnerOrders = orders.filter(o => o.partnerId === partner.id);
                const totalOrderAmount = partnerOrders.reduce((sum, o) => sum + (o.totalAmount || 0), 0);
                const totalOrderQuantity = partnerOrders.reduce((sum, o) => sum + (o.quantity || 0), 0);
                
                // í•´ë‹¹ ê±°ë˜ì²˜ì˜ ì…ê¸ˆ ê¸ˆì•¡ (ë‚´ê°€ ì§€ë¶ˆí•œ ëˆ)
                const partnerPayments = payments.filter(p => p.partnerId === partner.id);
                const totalPaymentAmount = partnerPayments.reduce((sum, p) => sum + (p.amount || 0), 0);
                
                // í•´ë‹¹ ê±°ë˜ì²˜ì˜ ì…ê³  ìˆ˜ëŸ‰ (ë‚´ê°€ ë°›ì€ ì¥ì–´)
                const partnerReceipts = receipts.filter(r => r.partnerId === partner.id);
                const totalReceiptQuantity = partnerReceipts.reduce((sum, r) => sum + (r.quantity || 0), 0);
                
                // ë‚´ê°€ ì¤„ ëˆ (ì„ ì£¼ë¬¸ + ì™¸ìƒ - ì…ê¸ˆ)
                const amountToPay = totalOrderAmount + totalAdvanceAmount - totalPaymentAmount;
                
                // ë‚´ê°€ ë°›ì„ ì¥ì–´ (ì„ ì£¼ë¬¸ - ì…ê³ )
                const eelToReceive = totalOrderQuantity - totalReceiptQuantity;
                
                // ìµœê·¼ ê±°ë˜ ê°€ê²© ì°¾ê¸°
                let latestPrice = 0;
                if (partnerOrders.length > 0) {
                    const sortedOrders = partnerOrders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    latestPrice = sortedOrders[0].price;
                }
                
                const totalAmount = totalAdvanceAmount + totalOrderAmount;
                
                return {
                    partner,
                    totalAdvanceAmount,
                    totalOrderAmount,
                    totalOrderQuantity,
                    totalPaymentAmount,
                    totalReceiptQuantity,
                    amountToPay,
                    eelToReceive,
                    latestPrice,
                    totalAmount,
                    advanceCount: partnerAdvances.length,
                    orderCount: partnerOrders.length,
                    paymentCount: partnerPayments.length,
                    receiptCount: partnerReceipts.length
                };
            }).filter(data => data.totalAmount > 0 || data.totalPaymentAmount > 0 || data.totalReceiptQuantity > 0) // ê±°ë˜ê°€ ìˆëŠ” ê±°ë˜ì²˜ë§Œ
              .sort((a, b) => Math.abs(b.amountToPay) - Math.abs(a.amountToPay)); // ì¤„ ëˆ ì ˆëŒ“ê°’ ë‚´ë¦¼ì°¨ìˆœ
            
            if (partnerData.length === 0) {
                container.innerHTML += '<p>ê±°ë˜ ë‚´ì—­ì´ ìˆëŠ” ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            partnerData.forEach(data => {
                const partnerDiv = document.createElement('div');
                partnerDiv.className = 'card';
                
                // ìƒíƒœ í‘œì‹œë¥¼ ìœ„í•œ ìƒ‰ìƒ ê²°ì •
                let statusColor = '#10b981'; // ê¸°ë³¸ ë…¹ìƒ‰ (ì •ìƒ)
                if (data.amountToPay < 0) {
                    statusColor = '#8b5cf6'; // ì´ˆê³¼ ì§€ë¶ˆ (ë³´ë¼ìƒ‰)
                } else if (data.totalAdvanceAmount > 500000) {
                    statusColor = '#ef4444'; // ì™¸ìƒì´ 50ë§Œì› ì´ìƒì´ë©´ ë¹¨ê°„ìƒ‰
                } else if (data.totalAdvanceAmount > 0) {
                    statusColor = '#f59e0b'; // ì™¸ìƒì´ ìˆìœ¼ë©´ ì£¼í™©ìƒ‰
                }
                
                partnerDiv.style.borderLeft = `4px solid ${statusColor}`;
                
                // ì¹´í…Œê³ ë¦¬ë³„ ì •ë³´ êµ¬ì„±
                let categoriesHTML = '';
                
                // 1. ì¤„ ëˆ (ë‚´ê°€ ì§€ë¶ˆí•´ì•¼ í•  ëˆ)
                if (data.amountToPay > 0) {
                    categoriesHTML += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span style="color: #ef4444;">ğŸ’° ì¤„ ëˆ:</span>
                            <strong style="color: #ef4444;">${formatNumber(data.amountToPay)}ì›</strong>
                        </div>
                    `;
                } else if (data.amountToPay < 0) {
                    categoriesHTML += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span style="color: #8b5cf6;">ğŸ’œ ì´ˆê³¼ì§€ë¶ˆ:</span>
                            <strong style="color: #8b5cf6;">${formatNumber(Math.abs(data.amountToPay))}ì›</strong>
                        </div>
                    `;
                }
                
                // 2. ë°›ì„ ì¥ì–´ (ë‚´ê°€ ë°›ì•„ì•¼ í•  ì¥ì–´)
                if (data.eelToReceive > 0) {
                    categoriesHTML += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span style="color: #10b981;">ğŸ ë°›ì„ ì¥ì–´:</span>
                            <strong style="color: #10b981;">${formatNumber(data.eelToReceive)}kg</strong>
                        </div>
                    `;
                } else if (data.eelToReceive < 0) {
                    categoriesHTML += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span style="color: #06b6d4;">ğŸ“¦ ì´ˆê³¼ì…ê³ :</span>
                            <strong style="color: #06b6d4;">${formatNumber(Math.abs(data.eelToReceive))}kg</strong>
                        </div>
                    `;
                }
                
                // 3. ì™¸ìƒ
                if (data.totalAdvanceAmount > 0) {
                    categoriesHTML += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span style="color: #f59e0b;">ğŸ’³ ì™¸ìƒ:</span>
                            <strong style="color: #f59e0b;">${formatNumber(data.totalAdvanceAmount)}ì› (${data.advanceCount}ê±´)</strong>
                        </div>
                    `;
                }
                
                // 4. ì„ ì£¼ë¬¸ í˜„í™©
                if (data.totalOrderAmount > 0) {
                    categoriesHTML += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span style="color: #3b82f6;">ğŸ“¦ ì„ ì£¼ë¬¸:</span>
                            <strong style="color: #3b82f6;">${formatNumber(data.totalOrderAmount)}ì› (${formatNumber(data.totalOrderQuantity)}kg)</strong>
                        </div>
                    `;
                }
                
                // 5. ì§€ë¶ˆ í˜„í™© (ì…ê¸ˆ -> ì§€ë¶ˆë¡œ ë³€ê²½)
                if (data.totalPaymentAmount > 0) {
                    categoriesHTML += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span style="color: #8b5cf6;">ğŸ’¸ ì§€ë¶ˆì™„ë£Œ:</span>
                            <strong style="color: #8b5cf6;">${formatNumber(data.totalPaymentAmount)}ì› (${data.paymentCount}ê±´)</strong>
                        </div>
                    `;
                }
                
                // 6. ì…ê³  í˜„í™©
                if (data.totalReceiptQuantity > 0) {
                    categoriesHTML += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span style="color: #06b6d4;">ğŸ“¥ ì…ê³ ì™„ë£Œ:</span>
                            <strong style="color: #06b6d4;">${formatNumber(data.totalReceiptQuantity)}kg (${data.receiptCount}ê±´)</strong>
                        </div>
                    `;
                }
                
                // ìƒíƒœ í‘œì‹œ
                let statusText = 'ì •ìƒ';
                let statusIcon = 'âœ…';
                if (data.amountToPay < 0) {
                    statusText = 'ì´ˆê³¼ì§€ë¶ˆ';
                    statusIcon = 'ğŸ’œ';
                } else if (data.totalAdvanceAmount > 500000) {
                    statusText = 'ê³ ì•¡ì™¸ìƒ';
                    statusIcon = 'ğŸš¨';
                } else if (data.totalAdvanceAmount > 0) {
                    statusText = 'ì™¸ìƒìˆìŒ';
                    statusIcon = 'âš ï¸';
                }
                
                // ìµœê·¼ ë‹¨ê°€ í‘œì‹œ
                const priceDisplay = data.latestPrice > 0 ? `(${formatNumber(data.latestPrice)}ì›/kg)` : '';
                
                // í•µì‹¬ ì •ë³´ë§Œ í¬ê²Œ í‘œì‹œ
                let mainInfoHTML = '';
                
                if (data.amountToPay > 0) {
                    mainInfoHTML += `
                        <div style="background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; padding: 10px; margin-bottom: 8px;">
                            <div style="color: #dc2626; font-weight: bold; font-size: 14px;">ğŸ’° ì¤„ ëˆ</div>
                            <div style="color: #dc2626; font-size: 18px; font-weight: bold;">${formatNumber(data.amountToPay)}ì›</div>
                        </div>
                    `;
                }
                
                if (data.eelToReceive > 0) {
                    mainInfoHTML += `
                        <div style="background: #dcfce7; border: 1px solid #10b981; border-radius: 6px; padding: 10px; margin-bottom: 8px;">
                            <div style="color: #059669; font-weight: bold; font-size: 14px;">ğŸ ë°›ì„ ì¥ì–´</div>
                            <div style="color: #059669; font-size: 18px; font-weight: bold;">${formatNumber(data.eelToReceive)}kg</div>
                        </div>
                    `;
                }
                
                // ì™¸ìƒì´ ìˆìœ¼ë©´ ê²½ê³  í‘œì‹œ
                if (data.totalAdvanceAmount > 0) {
                    mainInfoHTML += `
                        <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px; padding: 10px; margin-bottom: 8px;">
                            <div style="color: #d97706; font-weight: bold; font-size: 14px;">âš ï¸ ì™¸ìƒ</div>
                            <div style="color: #d97706; font-size: 18px; font-weight: bold;">${formatNumber(data.totalAdvanceAmount)}ì›</div>
                        </div>
                    `;
                }
                
                // ì´ˆê³¼ ì§€ë¶ˆ/ì…ê³ ì¸ ê²½ìš°
                if (data.amountToPay < 0) {
                    mainInfoHTML += `
                        <div style="background: #f3e8ff; border: 1px solid #8b5cf6; border-radius: 6px; padding: 10px; margin-bottom: 8px;">
                            <div style="color: #7c3aed; font-weight: bold; font-size: 14px;">ğŸ’œ ì´ˆê³¼ì§€ë¶ˆ</div>
                            <div style="color: #7c3aed; font-size: 18px; font-weight: bold;">${formatNumber(Math.abs(data.amountToPay))}ì›</div>
                        </div>
                    `;
                }
                
                if (data.eelToReceive < 0) {
                    mainInfoHTML += `
                        <div style="background: #ecfeff; border: 1px solid #06b6d4; border-radius: 6px; padding: 10px; margin-bottom: 8px;">
                            <div style="color: #0891b2; font-weight: bold; font-size: 14px;">ğŸ“¦ ì´ˆê³¼ì…ê³ </div>
                            <div style="color: #0891b2; font-size: 18px; font-weight: bold;">${formatNumber(Math.abs(data.eelToReceive))}kg</div>
                        </div>
                    `;
                }
                
                // ìƒì„¸ ì •ë³´ (ì ‘ì„ ìˆ˜ ìˆê²Œ)
                const detailsHTML = `
                    <details style="margin-top: 10px; font-size: 11px; color: #666;">
                        <summary style="cursor: pointer; font-weight: 600; color: #374151;">ìƒì„¸ ì •ë³´ ë³´ê¸°</summary>
                        <div style="margin-top: 8px; padding: 8px; background: #f9fafb; border-radius: 4px;">
                            ${data.totalOrderAmount > 0 ? `ğŸ“¦ ì´ ì„ ì£¼ë¬¸: ${formatNumber(data.totalOrderAmount)}ì› (${formatNumber(data.totalOrderQuantity)}kg)<br>` : ''}
                            ${data.totalPaymentAmount > 0 ? `ğŸ’¸ ì´ ì§€ë¶ˆ: ${formatNumber(data.totalPaymentAmount)}ì› (${data.paymentCount}ê±´)<br>` : ''}
                            ${data.totalReceiptQuantity > 0 ? `ğŸ“¥ ì´ ì…ê³ : ${formatNumber(data.totalReceiptQuantity)}kg (${data.receiptCount}ê±´)<br>` : ''}
                            ${data.totalAdvanceAmount > 0 ? `ğŸ’³ ì´ ì™¸ìƒ: ${formatNumber(data.totalAdvanceAmount)}ì› (${data.advanceCount}ê±´)<br>` : ''}
                        </div>
                    </details>
                `;
                
                // ê°€ê²© ì…ë ¥ ì„¹ì…˜
                const priceInputHTML = `
                    <div class="partner-price-input">
                        <h4>ğŸ“… ${data.partner.name} ì¥ì–´ ë‹¨ê°€ ì…ë ¥</h4>
                        <div class="price-input-group">
                            <input type="number" id="dashboardPrice_${data.partner.id}" placeholder="ë‹¨ê°€ ì…ë ¥" style="width: 80px;">
                            <span style="font-size: 12px; color: #666;">ì›/kg</span>
                            <button class="btn" onclick="setDashboardPrice('${data.partner.id}')">ì˜¤ëŠ˜ ë‹¨ê°€ ì €ì¥</button>
                            <button class="btn" onclick="toggleDashboardCalendar('${data.partner.id}')" style="background: #3b82f6;">ë‹¬ë ¥ ë³´ê¸°</button>
                        </div>
                        <div id="dashboardCalendar_${data.partner.id}" class="dashboard-calendar" style="display: none;">
                            <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                `;
                
                partnerDiv.innerHTML = `
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                    <strong style="font-size: 16px;">${data.partner.name}</strong>
                                    <div style="display: flex; align-items: center; gap: 5px;">
                                        <input type="number" id="quickPrice_${data.partner.id}" placeholder="ë‹¨ê°€" style="width: 70px; padding: 4px 6px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 12px;">
                                        <span style="font-size: 11px; color: #666;">ì›/kg</span>
                                        <button class="btn" onclick="setQuickPrice('${data.partner.id}')" style="padding: 4px 8px; font-size: 11px; background: #10b981;">ì €ì¥</button>
                                        <button class="btn" onclick="toggleQuickCalendar('${data.partner.id}')" style="padding: 4px 8px; font-size: 11px; background: #3b82f6;">ğŸ“… ë‹¬ë ¥</button>
                                    </div>
                                </div>
                                ${priceDisplay ? `<div style="font-size: 12px; color: #666;">ìµœê·¼ë‹¨ê°€: ${priceDisplay}</div>` : ''}
                                <div id="quickCalendar_${data.partner.id}" class="dashboard-calendar" style="display: none;">
                                    <!-- ì‘ì€ ë‹¬ë ¥ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <span style="font-size: 12px;">${statusIcon}</span>
                                <span style="font-size: 11px; color: #666;">${statusText}</span>
                            </div>
                        </div>
                        ${mainInfoHTML || '<div style="color: #999; text-align: center; padding: 20px;">ê±°ë˜ ë‚´ì—­ ì—†ìŒ</div>'}
                        ${detailsHTML}
                    </div>
                `;
                container.appendChild(partnerDiv);
                
                // ë‹¬ë ¥ ìë™ ë Œë”ë§
                setTimeout(() => {
                    renderQuickCalendar(data.partner.id);
                }, 100);
            });
        }

        function updatePartnersList() {
            const container = document.getElementById('partnerManagementList');
            if (!container) return;
            
            container.innerHTML = '<h3>ê±°ë˜ì²˜ ëª©ë¡</h3>';
            
            if (partners.length === 0) {
                container.innerHTML += '<p>ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            partners.forEach(partner => {
                const partnerDiv = document.createElement('div');
                partnerDiv.className = 'partner-item';
                partnerDiv.innerHTML = `
                    <div>
                        <strong>${partner.name}</strong>
                        <br>
                        <small>ì—°ë½ì²˜: ${partner.contact || 'ì—†ìŒ'}</small>
                        <br>
                        <small>ë“±ë¡ì¼: ${formatDate(partner.createdAt)}</small>
                    </div>
                    <div>
                        <button class="btn" onclick="editPartner('${partner.id}')">ìˆ˜ì •</button>
                        <button class="btn btn-danger" onclick="deletePartner('${partner.id}')">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(partnerDiv);
            });
        }

        function updateOrdersList() {
            const container = document.getElementById('ordersList');
            if (!container) return;
            
            container.innerHTML = '<h3>ì„ ì£¼ë¬¸ ëª©ë¡</h3>';
            
            if (orders.length === 0) {
                container.innerHTML += '<p>ë“±ë¡ëœ ì„ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            orders.reverse().forEach(order => {
                const partner = partners.find(p => p.id === order.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                
                const orderDiv = document.createElement('div');
                orderDiv.className = 'partner-item';
                orderDiv.innerHTML = `
                    <div>
                        <strong>${partnerName}</strong>
                        <br>
                        <small>ğŸ“… ì£¼ë¬¸ë‚ ì§œ: ${order.orderDate ? formatDate(order.orderDate) : 'ë‚ ì§œì—†ìŒ'}</small>
                        <br>
                        <small>ìˆ˜ëŸ‰: ${formatNumber(order.quantity)}kg</small>
                        <br>
                        <small>ë‹¨ê°€: ${formatNumber(order.price)}ì›/kg</small>
                        <br>
                        <small>ì´ì•¡: ${formatNumber(order.totalAmount)}ì›</small>
                        <br>
                        <small>ë©”ëª¨: ${order.memo || 'ì—†ìŒ'}</small>
                        <br>
                        <small>ë“±ë¡ì¼: ${formatDate(order.createdAt)}</small>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="deleteOrder('${order.id}')">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(orderDiv);
            });
            orders.reverse(); // ì›ë˜ ìˆœì„œë¡œ ë³µì›
        }

        function updateAdvancesList() {
            const container = document.getElementById('advancesList');
            if (!container) return;
            
            container.innerHTML = '<h3>ì™¸ìƒ ëª©ë¡</h3>';
            
            if (advances.length === 0) {
                container.innerHTML += '<p>ë“±ë¡ëœ ì™¸ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            advances.reverse().forEach(advance => {
                const partner = partners.find(p => p.id === advance.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                
                const advanceDiv = document.createElement('div');
                advanceDiv.className = 'partner-item';
                advanceDiv.innerHTML = `
                    <div>
                        <strong>${partnerName}</strong>
                        <br>
                        <small>ğŸ“… ì™¸ìƒë‚ ì§œ: ${advance.advanceDate ? formatDate(advance.advanceDate) : 'ë‚ ì§œì—†ìŒ'}</small>
                        <br>
                        <small>ì™¸ìƒê¸ˆì•¡: ${formatNumber(advance.amount)}ì›</small>
                        <br>
                        <small>ë©”ëª¨: ${advance.memo || 'ì—†ìŒ'}</small>
                        <br>
                        <small>ëŒ€ì‹œë³´ë“œ í‘œì‹œ: ${advance.hidden ? 'ìˆ¨ê¹€' : 'í‘œì‹œ'}</small>
                        <br>
                        <small>ë“±ë¡ì¼: ${formatDate(advance.createdAt)}</small>
                    </div>
                    <div>
                        <button class="btn" onclick="toggleAdvanceVisibility('${advance.id}')">${advance.hidden ? 'í‘œì‹œ' : 'ìˆ¨ê¹€'}</button>
                        <button class="btn btn-danger" onclick="deleteAdvance('${advance.id}')">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(advanceDiv);
            });
            advances.reverse(); // ì›ë˜ ìˆœì„œë¡œ ë³µì›
        }

        function updatePaymentsList() {
            const container = document.getElementById('paymentsList');
            if (!container) return;
            
            container.innerHTML = '<h3>ì…ê¸ˆ ëª©ë¡</h3>';
            
            if (payments.length === 0) {
                container.innerHTML += '<p>ë“±ë¡ëœ ì…ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            payments.reverse().forEach(payment => {
                const partner = partners.find(p => p.id === payment.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                
                const paymentDiv = document.createElement('div');
                paymentDiv.className = 'partner-item';
                paymentDiv.innerHTML = `
                    <div>
                        <strong>${partnerName}</strong>
                        <br>
                        <small>ğŸ“… ì…ê¸ˆë‚ ì§œ: ${payment.paymentDate ? formatDate(payment.paymentDate) : 'ë‚ ì§œì—†ìŒ'}</small>
                        <br>
                        <small>ì…ê¸ˆì•¡: ${formatNumber(payment.amount)}ì›</small>
                        <br>
                        <small>ë©”ëª¨: ${payment.memo || 'ì—†ìŒ'}</small>
                        <br>
                        <small>ë“±ë¡ì¼: ${formatDate(payment.createdAt)}</small>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="deletePayment('${payment.id}')">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(paymentDiv);
            });
            payments.reverse(); // ì›ë˜ ìˆœì„œë¡œ ë³µì›
        }

        function updateReceiptsList() {
            const container = document.getElementById('receiptsList');
            if (!container) return;
            
            container.innerHTML = '<h3>ì…ê³  ëª©ë¡</h3>';
            
            if (receipts.length === 0) {
                container.innerHTML += '<p>ë“±ë¡ëœ ì…ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            receipts.reverse().forEach(receipt => {
                const partner = partners.find(p => p.id === receipt.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                
                const receiptDiv = document.createElement('div');
                receiptDiv.className = 'partner-item';
                receiptDiv.innerHTML = `
                    <div>
                        <strong>${partnerName}</strong>
                        <br>
                        <small>ğŸ“… ì…ê³ ë‚ ì§œ: ${receipt.receiptDate ? formatDate(receipt.receiptDate) : 'ë‚ ì§œì—†ìŒ'}</small>
                        <br>
                        <small>ìˆ˜ëŸ‰: ${formatNumber(receipt.quantity)}kg</small>
                        <br>
                        <small>ë©”ëª¨: ${receipt.memo || 'ì—†ìŒ'}</small>
                        <br>
                        <small>ë“±ë¡ì¼: ${formatDate(receipt.createdAt)}</small>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="deleteReceipt('${receipt.id}')">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(receiptDiv);
            });
            receipts.reverse(); // ì›ë˜ ìˆœì„œë¡œ ë³µì›
        }

        function updateHistoryList() {
            const container = document.getElementById('historyList');
            if (!container) return;
            
            const selectedPartnerId = document.getElementById('historyFilter').value;
            
            container.innerHTML = '<h3>ê±°ë˜ë‚´ì—­</h3>';
            
            // ëª¨ë“  ê±°ë˜ ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ ë°°ì—´ë¡œ í†µí•©
            let allTransactions = [];
            
            // ì„ ì£¼ë¬¸ ì¶”ê°€
            orders.forEach(order => {
                const partner = partners.find(p => p.id === order.partnerId);
                if (!selectedPartnerId || order.partnerId === selectedPartnerId) {
                    allTransactions.push({
                        type: 'ì„ ì£¼ë¬¸',
                        partner: partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜',
                        amount: order.totalAmount,
                        quantity: order.quantity,
                        price: order.price,
                        memo: order.memo,
                        transactionDate: order.orderDate,
                        date: order.createdAt,
                        icon: 'ğŸ“¦'
                    });
                }
            });
            
            // ì™¸ìƒ ì¶”ê°€
            advances.forEach(advance => {
                const partner = partners.find(p => p.id === advance.partnerId);
                if (!selectedPartnerId || advance.partnerId === selectedPartnerId) {
                    allTransactions.push({
                        type: 'ì™¸ìƒ',
                        partner: partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜',
                        amount: advance.amount,
                        memo: advance.memo,
                        transactionDate: advance.advanceDate,
                        date: advance.createdAt,
                        icon: 'ğŸ’³',
                        hidden: advance.hidden
                    });
                }
            });
            
            // ì…ê¸ˆ ì¶”ê°€
            payments.forEach(payment => {
                const partner = partners.find(p => p.id === payment.partnerId);
                if (!selectedPartnerId || payment.partnerId === selectedPartnerId) {
                    allTransactions.push({
                        type: 'ì…ê¸ˆ',
                        partner: partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜',
                        amount: payment.amount,
                        memo: payment.memo,
                        transactionDate: payment.paymentDate,
                        date: payment.createdAt,
                        icon: 'ğŸ’°'
                    });
                }
            });
            
            // ì…ê³  ì¶”ê°€
            receipts.forEach(receipt => {
                const partner = partners.find(p => p.id === receipt.partnerId);
                if (!selectedPartnerId || receipt.partnerId === selectedPartnerId) {
                    allTransactions.push({
                        type: 'ì…ê³ ',
                        partner: partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜',
                        quantity: receipt.quantity,
                        memo: receipt.memo,
                        transactionDate: receipt.receiptDate,
                        date: receipt.createdAt,
                        icon: 'ğŸ“¥'
                    });
                }
            });
            
            if (allTransactions.length === 0) {
                container.innerHTML += '<p>ê±°ë˜ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
            allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            allTransactions.forEach(transaction => {
                const transactionDiv = document.createElement('div');
                transactionDiv.className = 'partner-item';
                
                let details = '';
                if (transaction.type === 'ì„ ì£¼ë¬¸') {
                    details = `<small>ìˆ˜ëŸ‰: ${formatNumber(transaction.quantity)}kg, ë‹¨ê°€: ${formatNumber(transaction.price)}ì›/kg</small><br>`;
                } else if (transaction.type === 'ì…ê³ ') {
                    details = `<small>ìˆ˜ëŸ‰: ${formatNumber(transaction.quantity)}kg</small><br>`;
                }
                
                const amountDisplay = transaction.amount ? `<small>ê¸ˆì•¡: ${formatNumber(transaction.amount)}ì›</small><br>` : '';
                const hiddenStatus = transaction.hidden ? ' <span style="color: #999;">(ìˆ¨ê¹€)</span>' : '';
                
                transactionDiv.innerHTML = `
                    <div>
                        <strong>${transaction.icon} ${transaction.type}${hiddenStatus}</strong>
                        <br>
                        <small>ê±°ë˜ì²˜: ${transaction.partner}</small>
                        <br>
                        ${transaction.transactionDate ? `<small>ğŸ“… ê±°ë˜ë‚ ì§œ: ${formatDate(transaction.transactionDate)}</small><br>` : ''}
                        ${details}
                        ${amountDisplay}
                        <small>ë©”ëª¨: ${transaction.memo || 'ì—†ìŒ'}</small>
                        <br>
                        <small>ë“±ë¡ì¼: ${formatDate(transaction.date)}</small>
                    </div>
                `;
                container.appendChild(transactionDiv);
            });
        }

        function updateSelects() {
            const selects = ['orderPartner', 'advancePartner', 'paymentPartner', 'receiptPartner', 'historyFilter'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
                    while (select.children.length > 1) {
                        select.removeChild(select.lastChild);
                    }
                    
                    // ê±°ë˜ì²˜ ì˜µì…˜ ì¶”ê°€
                    partners.forEach(partner => {
                        const option = document.createElement('option');
                        option.value = partner.id;
                        option.textContent = partner.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        // ê±°ë˜ì²˜ ìˆ˜ì •
        function editPartner(id) {
            const partner = partners.find(p => p.id === id);
            if (!partner) return;
            
            const newName = prompt('ê±°ë˜ì²˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:', partner.name);
            if (newName === null) return;
            
            if (!newName.trim()) {
                alert('ê±°ë˜ì²˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const newContact = prompt('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', partner.contact || '');
            
            partner.name = newName.trim();
            partner.contact = newContact ? newContact.trim() : '';
            partner.updatedAt = new Date().toISOString();
            
            saveData();
            updatePartnersList();
            updateSelects();
            alert('ê±°ë˜ì²˜ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ê±°ë˜ì²˜ ì‚­ì œ
        function deletePartner(id) {
            const partner = partners.find(p => p.id === id);
            if (!partner) return;
            
            if (!confirm(`'${partner.name}' ê±°ë˜ì²˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê´€ë ¨ëœ ëª¨ë“  ê±°ë˜ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                return;
            }
            
            // ê´€ë ¨ ë°ì´í„° ì‚­ì œ
            orders = orders.filter(order => order.partnerId !== id);
            advances = advances.filter(advance => advance.partnerId !== id);
            payments = payments.filter(payment => payment.partnerId !== id);
            receipts = receipts.filter(receipt => receipt.partnerId !== id);
            partners = partners.filter(p => p.id !== id);
            
            saveData();
            updatePartnersList();
            updateSelects();
            alert('ê±°ë˜ì²˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ê±°ë˜ì²˜ë³„ ì •ë³´ í‘œì‹œ
        function showPartnerInfo(type) {
            let partnerId, infoContainer;
            
            if (type === 'payment') {
                partnerId = document.getElementById('paymentPartner').value;
                infoContainer = document.getElementById('paymentPartnerInfo');
            } else if (type === 'receipt') {
                partnerId = document.getElementById('receiptPartner').value;
                infoContainer = document.getElementById('receiptPartnerInfo');
            }
            
            if (!partnerId || !infoContainer) {
                if (infoContainer) infoContainer.style.display = 'none';
                return;
            }
            
            const partner = partners.find(p => p.id === partnerId);
            if (!partner) {
                infoContainer.style.display = 'none';
                return;
            }
            
            // ê±°ë˜ì²˜ ë°ì´í„° ê³„ì‚° (ì§€ë¶ˆê´€ë¦¬ì—ì„œëŠ” ìˆ¨ê²¨ì§„ ì™¸ìƒë„ í¬í•¨)
            const partnerAdvances = advances.filter(a => a.partnerId === partnerId);
            const totalAdvanceAmount = partnerAdvances.reduce((sum, a) => sum + (a.amount || 0), 0);
            const hiddenAdvances = partnerAdvances.filter(a => a.hidden === true);
            const visibleAdvances = partnerAdvances.filter(a => a.hidden !== true);
            
            const partnerOrders = orders.filter(o => o.partnerId === partnerId);
            const totalOrderAmount = partnerOrders.reduce((sum, o) => sum + (o.totalAmount || 0), 0);
            const totalOrderQuantity = partnerOrders.reduce((sum, o) => sum + (o.quantity || 0), 0);
            
            const partnerPayments = payments.filter(p => p.partnerId === partnerId);
            const totalPaymentAmount = partnerPayments.reduce((sum, p) => sum + (p.amount || 0), 0);
            
            const partnerReceipts = receipts.filter(r => r.partnerId === partnerId);
            const totalReceiptQuantity = partnerReceipts.reduce((sum, r) => sum + (r.quantity || 0), 0);
            
            // ì‹¤ì œ ë°›ì„ ê¸ˆì•¡ê³¼ ë°›ì„ ì¥ì–´
            const actualReceivable = totalOrderAmount + totalAdvanceAmount - totalPaymentAmount;
            const pendingEelQuantity = totalOrderQuantity - totalReceiptQuantity;
            
            let infoHTML = `<strong>${partner.name} ê±°ë˜ì²˜ í˜„í™©</strong><br><br>`;
            
            if (type === 'payment') {
                const hiddenAmount = hiddenAdvances.reduce((sum, a) => sum + (a.amount || 0), 0);
                const visibleAmount = visibleAdvances.reduce((sum, a) => sum + (a.amount || 0), 0);
                
                infoHTML += `
                    ğŸ’° <strong>ì´ ì¤„ ëˆ: ${formatNumber(actualReceivable)}ì›</strong><br><br>
                    ğŸ’³ <strong style="color: #dc2626;">ì´ ì™¸ìƒê¸ˆì•¡: ${formatNumber(totalAdvanceAmount)}ì›</strong><br>
                    ${visibleAmount > 0 ? `ã€€â”” í‘œì‹œëœ ì™¸ìƒ: ${formatNumber(visibleAmount)}ì› (${visibleAdvances.length}ê±´)<br>` : ''}
                    ${hiddenAmount > 0 ? `ã€€â”” <span style="color: #6b7280;">ìˆ¨ê²¨ì§„ ì™¸ìƒ: ${formatNumber(hiddenAmount)}ì› (${hiddenAdvances.length}ê±´)</span><br>` : ''}
                    ğŸ“¦ ì„ ì£¼ë¬¸ê¸ˆì•¡: ${formatNumber(totalOrderAmount)}ì›<br>
                    ğŸ’¸ ê¸°ì§€ë¶ˆê¸ˆì•¡: ${formatNumber(totalPaymentAmount)}ì›<br><br>
                    <small>* ì§€ë¶ˆê´€ë¦¬ì—ì„œëŠ” ëª¨ë“  ì™¸ìƒ(ìˆ¨ê¹€ í¬í•¨)ì´ ê³„ì‚°ì— ë°˜ì˜ë©ë‹ˆë‹¤</small>
                `;
            } else if (type === 'receipt') {
                infoHTML += `
                    ğŸ <strong>ë°›ì„ ì¥ì–´: ${formatNumber(pendingEelQuantity)}kg</strong><br>
                    ğŸ“¦ ì„ ì£¼ë¬¸: ${formatNumber(totalOrderQuantity)}kg<br>
                    ğŸ“¥ ê¸°ì…ê³ : ${formatNumber(totalReceiptQuantity)}kg<br>
                    ğŸ’° ì´ì£¼ë¬¸ê¸ˆì•¡: ${formatNumber(totalOrderAmount)}ì›
                `;
            }
            
            infoContainer.innerHTML = infoHTML;
            infoContainer.style.display = 'block';
        }
        
        // ê±°ë˜ì²˜ë³„ ë‹¬ë ¥ í‘œì‹œ
        function showPartnerCalendar(type) {
            const partnerId = document.getElementById('orderPartner').value;
            const calendarContainer = document.getElementById('orderPartnerCalendar');
            
            if (!partnerId || !calendarContainer) {
                if (calendarContainer) calendarContainer.style.display = 'none';
                return;
            }
            
            const partner = partners.find(p => p.id === partnerId);
            if (!partner) {
                calendarContainer.style.display = 'none';
                return;
            }
            
            renderPartnerCalendar(partnerId, partner.name, calendarContainer);
            calendarContainer.style.display = 'block';
        }
        
        // ê±°ë˜ì²˜ë³„ ë‹¬ë ¥ ë Œë”ë§
        function renderPartnerCalendar(partnerId, partnerName, container) {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            
            let calendarHTML = `
                <div class="partner-calendar-header">
                    ${partnerName} - ${year}ë…„ ${month + 1}ì›” ê°€ê²© ë‹¬ë ¥
                </div>
                <div class="partner-calendar-grid">
            `;
            
            // ìš”ì¼ í—¤ë”
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            days.forEach(day => {
                calendarHTML += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // ë‹¬ë ¥ ë‚ ì§œë“¤
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    const cellDate = new Date(startDate);
                    cellDate.setDate(startDate.getDate() + (week * 7) + day);
                    
                    const isCurrentMonth = cellDate.getMonth() === month;
                    const dateKey = formatDateKey(cellDate);
                    const priceKey = `${partnerId}_${dateKey}`;
                    const priceInfo = partnerPrices[priceKey];
                    
                    let cellClass = 'partner-calendar-cell';
                    if (!isCurrentMonth) cellClass += ' other-month';
                    if (priceInfo) cellClass += ' has-price';
                    
                    const priceBadge = priceInfo ? 
                        `<div class="calendar-price-badge">${formatNumber(priceInfo.price)}ì›</div>` : '';
                    
                    calendarHTML += `
                        <div class="${cellClass}" onclick="selectPartnerCalendarDate('${partnerId}', '${dateKey}', this)">
                            <div>${cellDate.getDate()}</div>
                            ${priceBadge}
                        </div>
                    `;
                }
            }
            
            calendarHTML += `</div>`;
            
            // ê°€ê²© ì…ë ¥ ì„¹ì…˜
            calendarHTML += `
                <div class="price-input-section" id="partnerPriceInput_${partnerId}" style="display: none;">
                    <h4>ê°€ê²© ì„¤ì •</h4>
                    <div style="margin-bottom: 10px;">
                        <strong id="selectedPartnerDate_${partnerId}"></strong>
                    </div>
                    <div class="form-group">
                        <label>ì¥ì–´ ë‹¨ê°€ (ì›/kg)</label>
                        <input type="number" id="partnerPrice_${partnerId}" placeholder="ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ë©”ëª¨</label>
                        <input type="text" id="partnerPriceNote_${partnerId}" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <button class="btn" onclick="setPartnerPrice('${partnerId}')">ê°€ê²© ì„¤ì •</button>
                    <button class="btn btn-danger" onclick="clearPartnerPrice('${partnerId}')">ê°€ê²© ì‚­ì œ</button>
                </div>
            `;
            
            container.innerHTML = calendarHTML;
        }
        
        // ê±°ë˜ì²˜ ë‹¬ë ¥ ë‚ ì§œ ì„ íƒ
        function selectPartnerCalendarDate(partnerId, dateKey, element) {
            // ì´ì „ ì„ íƒ ì œê±°
            const container = element.closest('.partner-calendar');
            container.querySelectorAll('.partner-calendar-cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            // ìƒˆ ì„ íƒ ì¶”ê°€
            element.classList.add('selected');
            
            // ê°€ê²© ì…ë ¥ ì„¹ì…˜ í‘œì‹œ
            const priceInputSection = document.getElementById(`partnerPriceInput_${partnerId}`);
            const selectedDateSpan = document.getElementById(`selectedPartnerDate_${partnerId}`);
            const priceInput = document.getElementById(`partnerPrice_${partnerId}`);
            const priceNoteInput = document.getElementById(`partnerPriceNote_${partnerId}`);
            
            const [year, month, day] = dateKey.split('-');
            const selectedDate = new Date(year, month - 1, day);
            selectedDateSpan.textContent = formatDate(selectedDate);
            priceInputSection.style.display = 'block';
            
            // ê¸°ì¡´ ê°€ê²© ì •ë³´ ë¡œë“œ
            const priceKey = `${partnerId}_${dateKey}`;
            const priceInfo = partnerPrices[priceKey];
            if (priceInfo) {
                priceInput.value = priceInfo.price;
                priceNoteInput.value = priceInfo.note || '';
            } else {
                priceInput.value = '';
                priceNoteInput.value = '';
            }
            
            // ì„ íƒí•œ ê°€ê²©ì„ ë‹¨ê°€ í•„ë“œì— ìë™ ì…ë ¥
            if (priceInfo && document.getElementById('orderPrice')) {
                document.getElementById('orderPrice').value = priceInfo.price;
                calculateOrderTotal(); // ì´ì•¡ ì¬ê³„ì‚°
            }
        }
        
        // ê±°ë˜ì²˜ë³„ ê°€ê²© ì„¤ì •
        function setPartnerPrice(partnerId) {
            const selectedCell = document.querySelector('.partner-calendar-cell.selected');
            if (!selectedCell) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            const dateKey = selectedCell.onclick.toString().match(/'([^']+)'/g)[1].replace(/'/g, '');
            const price = parseFloat(document.getElementById(`partnerPrice_${partnerId}`).value);
            const note = document.getElementById(`partnerPriceNote_${partnerId}`).value.trim();
            
            if (!price || price <= 0) {
                alert('ì˜¬ë°”ë¥¸ ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const priceKey = `${partnerId}_${dateKey}`;
            partnerPrices[priceKey] = {
                price: price,
                note: note,
                updatedAt: new Date().toISOString()
            };
            
            saveData();
            showPartnerCalendar('order'); // ë‹¬ë ¥ ì¬ë Œë”ë§
            alert('ê°€ê²©ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ê±°ë˜ì²˜ë³„ ê°€ê²© ì‚­ì œ
        function clearPartnerPrice(partnerId) {
            const selectedCell = document.querySelector('.partner-calendar-cell.selected');
            if (!selectedCell) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            const dateKey = selectedCell.onclick.toString().match(/'([^']+)'/g)[1].replace(/'/g, '');
            const priceKey = `${partnerId}_${dateKey}`;
            
            if (!partnerPrices[priceKey]) {
                alert('ì„¤ì •ëœ ê°€ê²©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ì´ ë‚ ì§œì˜ ê°€ê²© ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                delete partnerPrices[priceKey];
                saveData();
                showPartnerCalendar('order'); // ë‹¬ë ¥ ì¬ë Œë”ë§
                alert('ê°€ê²©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì„ ì£¼ë¬¸ ì¶”ê°€
        function addOrder() {
            console.log('addOrder í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const partnerId = document.getElementById('orderPartner').value;
            const orderDate = document.getElementById('orderDate').value;
            const quantity = parseFloat(document.getElementById('orderQuantity').value);
            const price = parseFloat(document.getElementById('orderPrice').value);
            const memo = document.getElementById('orderMemo').value.trim();
            
            console.log('ì…ë ¥ê°’:', {partnerId, orderDate, quantity, price, memo});
            
            if (!partnerId) {
                alert('ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!orderDate) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!quantity || quantity <= 0) {
                alert('ì˜¬ë°”ë¥¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            if (!price || price <= 0) {
                alert('ì˜¬ë°”ë¥¸ ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const order = {
                id: generateId(),
                partnerId: partnerId,
                orderDate: orderDate,
                quantity: quantity,
                price: price,
                totalAmount: quantity * price,
                memo: memo,
                createdAt: new Date().toISOString()
            };
            
            orders.push(order);
            saveData();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('orderPartner').value = '';
            document.getElementById('orderQuantity').value = '';
            document.getElementById('orderPrice').value = '';
            document.getElementById('orderTotal').value = '';
            document.getElementById('orderMemo').value = '';
            document.getElementById('orderPartnerCalendar').style.display = 'none';
            
            updateOrdersList();
            updateDashboard();
            alert('ì„ ì£¼ë¬¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì„ ì£¼ë¬¸ ì‚­ì œ
        function deleteOrder(id) {
            const order = orders.find(o => o.id === id);
            if (!order) return;
            
            const partner = partners.find(p => p.id === order.partnerId);
            const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
            
            if (!confirm(`${partnerName}ì˜ ì„ ì£¼ë¬¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìˆ˜ëŸ‰: ${formatNumber(order.quantity)}kg\nì´ì•¡: ${formatNumber(order.totalAmount)}ì›`)) {
                return;
            }
            
            orders = orders.filter(o => o.id !== id);
            saveData();
            updateOrdersList();
            alert('ì„ ì£¼ë¬¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        // ì™¸ìƒ ì¶”ê°€
        function addAdvance() {
            console.log('addAdvance í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const partnerId = document.getElementById('advancePartner').value;
            const advanceDate = document.getElementById('advanceDate').value;
            const amount = parseFloat(document.getElementById('advanceAmount').value);
            const memo = document.getElementById('advanceMemo').value.trim();
            const hidden = document.getElementById('advanceHidden').checked;
            
            console.log('ì…ë ¥ê°’:', {partnerId, advanceDate, amount, memo, hidden});
            
            if (!partnerId) {
                alert('ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!advanceDate) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!amount || amount <= 0) {
                alert('ì˜¬ë°”ë¥¸ ì™¸ìƒê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const advance = {
                id: generateId(),
                partnerId: partnerId,
                advanceDate: advanceDate,
                amount: amount,
                memo: memo,
                hidden: hidden,
                createdAt: new Date().toISOString()
            };
            
            advances.push(advance);
            saveData();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('advancePartner').value = '';
            document.getElementById('advanceAmount').value = '';
            document.getElementById('advanceMemo').value = '';
            document.getElementById('advanceHidden').checked = false;
            
            updateAdvancesList();
            updateDashboard(); // ëŒ€ì‹œë³´ë“œë„ ì—…ë°ì´íŠ¸
            alert('ì™¸ìƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì™¸ìƒ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
        function toggleAdvanceVisibility(id) {
            const advance = advances.find(a => a.id === id);
            if (!advance) return;
            
            advance.hidden = !advance.hidden;
            saveData();
            updateAdvancesList();
            updateDashboard(); // ëŒ€ì‹œë³´ë“œë„ ì—…ë°ì´íŠ¸
            
            const status = advance.hidden ? 'ìˆ¨ê¹€' : 'í‘œì‹œ';
            alert(`ì™¸ìƒì´ ëŒ€ì‹œë³´ë“œì—ì„œ ${status} ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì™¸ìƒ ì‚­ì œ
        function deleteAdvance(id) {
            const advance = advances.find(a => a.id === id);
            if (!advance) return;
            
            const partner = partners.find(p => p.id === advance.partnerId);
            const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
            
            if (!confirm(`${partnerName}ì˜ ì™¸ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì™¸ìƒê¸ˆì•¡: ${formatNumber(advance.amount)}ì›`)) {
                return;
            }
            
            advances = advances.filter(a => a.id !== id);
            saveData();
            updateAdvancesList();
            alert('ì™¸ìƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        // ì…ê¸ˆ ì¶”ê°€
        function addPayment() {
            console.log('addPayment í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const partnerId = document.getElementById('paymentPartner').value;
            const paymentDate = document.getElementById('paymentDate').value;
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const memo = document.getElementById('paymentMemo').value.trim();
            
            console.log('ì…ë ¥ê°’:', {partnerId, paymentDate, amount, memo});
            
            if (!partnerId) {
                alert('ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!paymentDate) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!amount || amount <= 0) {
                alert('ì˜¬ë°”ë¥¸ ì…ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const payment = {
                id: generateId(),
                partnerId: partnerId,
                paymentDate: paymentDate,
                amount: amount,
                memo: memo,
                createdAt: new Date().toISOString()
            };
            
            payments.push(payment);
            saveData();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('paymentPartner').value = '';
            document.getElementById('paymentAmount').value = '';
            document.getElementById('paymentMemo').value = '';
            document.getElementById('paymentPartnerInfo').style.display = 'none';
            
            updatePaymentsList();
            updateDashboard();
            alert('ì…ê¸ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì…ê¸ˆ ì‚­ì œ
        function deletePayment(id) {
            const payment = payments.find(p => p.id === id);
            if (!payment) return;
            
            const partner = partners.find(p => p.id === payment.partnerId);
            const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
            
            if (!confirm(`${partnerName}ì˜ ì…ê¸ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì…ê¸ˆì•¡: ${formatNumber(payment.amount)}ì›`)) {
                return;
            }
            
            payments = payments.filter(p => p.id !== id);
            saveData();
            updatePaymentsList();
            alert('ì…ê¸ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì…ê³  ì¶”ê°€
        function addReceipt() {
            console.log('addReceipt í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const partnerId = document.getElementById('receiptPartner').value;
            const receiptDate = document.getElementById('receiptDate').value;
            const quantity = parseFloat(document.getElementById('receiptQuantity').value);
            const memo = document.getElementById('receiptMemo').value.trim();
            
            console.log('ì…ë ¥ê°’:', {partnerId, receiptDate, quantity, memo});
            
            if (!partnerId) {
                alert('ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!receiptDate) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!quantity || quantity <= 0) {
                alert('ì˜¬ë°”ë¥¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const receipt = {
                id: generateId(),
                partnerId: partnerId,
                receiptDate: receiptDate,
                quantity: quantity,
                memo: memo,
                createdAt: new Date().toISOString()
            };
            
            receipts.push(receipt);
            saveData();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('receiptPartner').value = '';
            document.getElementById('receiptQuantity').value = '';
            document.getElementById('receiptMemo').value = '';
            document.getElementById('receiptPartnerInfo').style.display = 'none';
            
            updateReceiptsList();
            updateDashboard();
            alert('ì…ê³ ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì…ê³  ì‚­ì œ
        function deleteReceipt(id) {
            const receipt = receipts.find(r => r.id === id);
            if (!receipt) return;
            
            const partner = partners.find(p => p.id === receipt.partnerId);
            const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
            
            if (!confirm(`${partnerName}ì˜ ì…ê³ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìˆ˜ëŸ‰: ${formatNumber(receipt.quantity)}kg`)) {
                return;
            }
            
            receipts = receipts.filter(r => r.id !== id);
            saveData();
            updateReceiptsList();
            alert('ì…ê³ ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            const selectedPartnerId = document.getElementById('historyFilter').value;
            const selectedPartnerName = selectedPartnerId ? 
                partners.find(p => p.id === selectedPartnerId)?.name || 'ì•Œ ìˆ˜ ì—†ìŒ' : 'ì „ì²´';
            
            let csvContent = "ê±°ë˜ì²˜,ê±°ë˜ìœ í˜•,ê¸ˆì•¡,ìˆ˜ëŸ‰,ë‹¨ê°€,ë©”ëª¨,ë“±ë¡ì¼\n";
            
            // ì„ ì£¼ë¬¸ ë°ì´í„°
            orders.forEach(order => {
                if (!selectedPartnerId || order.partnerId === selectedPartnerId) {
                    const partner = partners.find(p => p.id === order.partnerId);
                    const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                    csvContent += `"${partnerName}","ì„ ì£¼ë¬¸","${order.totalAmount}","${order.quantity}","${order.price}","${order.memo || ''}","${formatDate(order.createdAt)}"\n`;
                }
            });
            
            // ì™¸ìƒ ë°ì´í„°
            advances.forEach(advance => {
                if (!selectedPartnerId || advance.partnerId === selectedPartnerId) {
                    const partner = partners.find(p => p.id === advance.partnerId);
                    const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                    const hiddenStatus = advance.hidden ? ' (ìˆ¨ê¹€)' : '';
                    csvContent += `"${partnerName}","ì™¸ìƒ${hiddenStatus}","${advance.amount}","","","${advance.memo || ''}","${formatDate(advance.createdAt)}"\n`;
                }
            });
            
            // ì…ê¸ˆ ë°ì´í„°
            payments.forEach(payment => {
                if (!selectedPartnerId || payment.partnerId === selectedPartnerId) {
                    const partner = partners.find(p => p.id === payment.partnerId);
                    const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                    csvContent += `"${partnerName}","ì…ê¸ˆ","${payment.amount}","","","${payment.memo || ''}","${formatDate(payment.createdAt)}"\n`;
                }
            });
            
            // ì…ê³  ë°ì´í„°
            receipts.forEach(receipt => {
                if (!selectedPartnerId || receipt.partnerId === selectedPartnerId) {
                    const partner = partners.find(p => p.id === receipt.partnerId);
                    const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                    csvContent += `"${partnerName}","ì…ê³ ","","${receipt.quantity}","","${receipt.memo || ''}","${formatDate(receipt.createdAt)}"\n`;
                }
            });
            
            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `ì¥ì–´ê±°ë˜ë‚´ì—­_${selectedPartnerName}_${new Date().toISOString().substr(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`${selectedPartnerName} ê±°ë˜ë‚´ì—­ì´ CSV íŒŒì¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.`);
        }

        function formatDateKey(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // ëŒ€ì‹œë³´ë“œì—ì„œ ì˜¤ëŠ˜ ë‹¨ê°€ ì €ì¥
        function setDashboardPrice(partnerId) {
            const priceInput = document.getElementById(`dashboardPrice_${partnerId}`);
            const price = parseFloat(priceInput.value);
            
            if (!price || price <= 0) {
                alert('ì˜¬ë°”ë¥¸ ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const today = new Date();
            const dateKey = formatDateKey(today);
            const priceKey = `${partnerId}_${dateKey}`;
            
            partnerPrices[priceKey] = {
                price: price,
                note: 'ëŒ€ì‹œë³´ë“œì—ì„œ ì…ë ¥',
                updatedAt: new Date().toISOString()
            };
            
            saveData();
            priceInput.value = '';
            
            // ë‹¬ë ¥ì´ ì—´ë ¤ìˆë‹¤ë©´ ìƒˆë¡œê³ ì¹¨
            const calendar = document.getElementById(`dashboardCalendar_${partnerId}`);
            if (calendar && calendar.style.display === 'block') {
                renderDashboardCalendar(partnerId);
            }
            
            // ëŒ€ì‹œë³´ë“œ ì „ì²´ ìƒˆë¡œê³ ì¹¨
            updateDashboard();
            alert('ì˜¤ëŠ˜ ë‹¨ê°€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ëŒ€ì‹œë³´ë“œ ë‹¬ë ¥ í† ê¸€
        function toggleDashboardCalendar(partnerId) {
            const calendar = document.getElementById(`dashboardCalendar_${partnerId}`);
            
            if (calendar.style.display === 'none') {
                renderDashboardCalendar(partnerId);
                calendar.style.display = 'block';
            } else {
                calendar.style.display = 'none';
            }
        }

        // ëŒ€ì‹œë³´ë“œ ë‹¬ë ¥ ë Œë”ë§
        function renderDashboardCalendar(partnerId) {
            const calendar = document.getElementById(`dashboardCalendar_${partnerId}`);
            if (!calendar) return;
            
            const partner = partners.find(p => p.id === partnerId);
            if (!partner) return;
            
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            
            let calendarHTML = `
                <div class="dashboard-calendar-header">
                    ${partner.name} - ${year}ë…„ ${month + 1}ì›” ë‹¨ê°€ í˜„í™©
                </div>
                <div class="dashboard-calendar-grid">
            `;
            
            // ìš”ì¼ í—¤ë”
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            days.forEach(day => {
                calendarHTML += `<div style="background: #f8fafc; padding: 4px; text-align: center; font-weight: 600; border: 1px solid #e5e7eb; font-size: 10px;">${day}</div>`;
            });
            
            // ë‹¬ë ¥ ë‚ ì§œë“¤
            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    const cellDate = new Date(startDate);
                    cellDate.setDate(startDate.getDate() + (week * 7) + day);
                    
                    const isCurrentMonth = cellDate.getMonth() === month;
                    const dateKey = formatDateKey(cellDate);
                    const priceKey = `${partnerId}_${dateKey}`;
                    const priceInfo = partnerPrices[priceKey];
                    
                    let cellClass = 'dashboard-calendar-cell';
                    if (!isCurrentMonth) cellClass += ' other-month';
                    if (priceInfo) cellClass += ' has-price';
                    
                    const priceBadge = priceInfo ? 
                        `<div class="dashboard-price-badge">${formatNumber(priceInfo.price)}ì›</div>` : '';
                    
                    calendarHTML += `
                        <div class="${cellClass}">
                            <div>${cellDate.getDate()}</div>
                            ${priceBadge}
                        </div>
                    `;
                }
            }
            
            calendarHTML += `</div>`;
            calendar.innerHTML = calendarHTML;
        }

        // ë¹ ë¥¸ ë‹¨ê°€ ì €ì¥ (ëŒ€ì‹œë³´ë“œì—ì„œ ê±°ë˜ì²˜ ì´ë¦„ ì˜† ì…ë ¥)
        function setQuickPrice(partnerId) {
            const priceInput = document.getElementById(`quickPrice_${partnerId}`);
            const price = parseFloat(priceInput.value);
            
            if (!price || price <= 0) {
                alert('ì˜¬ë°”ë¥¸ ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const today = new Date();
            const dateKey = formatDateKey(today);
            const priceKey = `${partnerId}_${dateKey}`;
            
            partnerPrices[priceKey] = {
                price: price,
                note: 'ëŒ€ì‹œë³´ë“œì—ì„œ ë¹ ë¥¸ ì…ë ¥',
                updatedAt: new Date().toISOString()
            };
            
            saveData();
            priceInput.value = '';
            
            // ë‹¬ë ¥ ìƒˆë¡œê³ ì¹¨
            renderQuickCalendar(partnerId);
            
            // ëŒ€ì‹œë³´ë“œ ì „ì²´ ìƒˆë¡œê³ ì¹¨ (ìµœê·¼ ë‹¨ê°€ ì—…ë°ì´íŠ¸)
            updateDashboard();
            alert('ì˜¤ëŠ˜ ë‹¨ê°€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ë¹ ë¥¸ ë‹¬ë ¥ ë Œë”ë§ (ê±°ë˜ì²˜ ì´ë¦„ ì•„ë˜ ì‘ì€ ë‹¬ë ¥)
        function renderQuickCalendar(partnerId) {
            const calendar = document.getElementById(`quickCalendar_${partnerId}`);
            if (!calendar) return;
            
            const partner = partners.find(p => p.id === partnerId);
            if (!partner) return;
            
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            
            let calendarHTML = `
                <div class="dashboard-calendar-header">
                    ${partner.name} - ${year}ë…„ ${month + 1}ì›”
                </div>
                <div class="dashboard-calendar-grid">
            `;
            
            // ìš”ì¼ í—¤ë”
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            days.forEach(day => {
                calendarHTML += `<div style="background: #f8fafc; padding: 3px; text-align: center; font-weight: 600; border: 1px solid #e5e7eb; font-size: 9px;">${day}</div>`;
            });
            
            // ë‹¬ë ¥ ë‚ ì§œë“¤
            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    const cellDate = new Date(startDate);
                    cellDate.setDate(startDate.getDate() + (week * 7) + day);
                    
                    const isCurrentMonth = cellDate.getMonth() === month;
                    const dateKey = formatDateKey(cellDate);
                    const priceKey = `${partnerId}_${dateKey}`;
                    const priceInfo = partnerPrices[priceKey];
                    
                    let cellClass = 'dashboard-calendar-cell';
                    if (!isCurrentMonth) cellClass += ' other-month';
                    if (priceInfo) cellClass += ' has-price';
                    
                    const priceBadge = priceInfo ? 
                        `<div class="dashboard-price-badge">${formatNumber(priceInfo.price)}</div>` : '';
                    
                    calendarHTML += `
                        <div class="${cellClass}" style="min-height: 25px; padding: 2px;">
                            <div style="font-size: 9px;">${cellDate.getDate()}</div>
                            ${priceBadge}
                        </div>
                    `;
                }
            }
            
            calendarHTML += `</div>`;
            calendar.innerHTML = calendarHTML;
        }

        // ë¹ ë¥¸ ë‹¬ë ¥ í† ê¸€ (ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°)
        function toggleQuickCalendar(partnerId) {
            const calendar = document.getElementById(`quickCalendar_${partnerId}`);
            if (!calendar) return;
            
            if (calendar.style.display === 'none' || calendar.style.display === '') {
                calendar.style.display = 'block';
                // ë‹¬ë ¥ì´ ë³´ì¼ ë•Œ ë Œë”ë§
                setTimeout(() => renderQuickCalendar(partnerId), 10);
            } else {
                calendar.style.display = 'none';
            }
        }
    </script>
</body>
</html>