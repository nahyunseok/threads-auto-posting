<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ ì¥ì–´ ì£¼ë¬¸ê´€ë¦¬ ì‹œìŠ¤í…œ (ê°œì„ ë²„ì „ v2.1)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #e8f5e8 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        
        h1 {
            color: #1f2937;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            margin-right: 10px;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .nav-tab.active {
            background: #3b82f6;
            color: white;
        }
        
        .nav-tab:hover {
            background: #e5e7eb;
        }
        
        .nav-tab.active:hover {
            background: #2563eb;
        }
        
        .content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: #2563eb;
        }
        
        .btn-success {
            background: #10b981;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: #ef4444;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-warning {
            background: #f59e0b;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        .grid {
            display: grid;
            gap: 20px;
        }
        
        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
        
        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .stats-card.red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .stats-card.orange {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .stats-card.green {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .stats-card.purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 900;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            line-height: 1.1;
        }
        
        .detail-label {
            font-size: 1rem;
            color: #6b7280;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .stats-card .detail-label {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        
        .partner-card {
            border-left: 4px solid #3b82f6;
            margin-bottom: 15px;
        }
        
        .partner-card.warning {
            border-left-color: #f59e0b;
            background: #fefbf0;
        }
        
        .partner-card.completed {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .partner-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .partner-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #1f2937;
        }
        
        .partner-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            text-align: center;
            padding: 10px;
            background: #f9fafb;
            border-radius: 6px;
        }
        
        .detail-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-weight: bold;
            color: #1f2937;
        }
        
        .hide {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-gray {
            color: #6b7280;
        }
        
        .text-red {
            color: #ef4444;
        }
        
        .text-orange {
            color: #f59e0b;
        }
        
        .text-green {
            color: #10b981;
        }
        
        .text-purple {
            color: #8b5cf6;
        }
        
        .delete-btn {
            background: #f3f4f6;
            color: #6b7280;
            border: none;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .delete-btn:hover {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .payment-breakdown {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.875rem;
        }
        
        .advance-indicator {
            background: #fef3c7;
            color: #d97706;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* ì¥ì–´ë‹¨ê°€ ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
        .price-calendar-container {
            position: relative;
            display: inline-block;
        }
        
        .price-calendar {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            min-width: 300px;
            padding: 15px;
            display: none;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav-btn {
            background: #f3f4f6;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .calendar-nav-btn:hover {
            background: #e5e7eb;
        }
        
        .calendar-month-year {
            font-weight: bold;
            font-size: 16px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            color: #6b7280;
            padding: 8px 4px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 8px 4px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            position: relative;
            min-height: 35px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .calendar-day:hover {
            background: #f3f4f6;
        }
        
        .calendar-day.other-month {
            color: #d1d5db;
        }
        
        .calendar-day.today {
            background: #3b82f6;
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.selected {
            background: #10b981;
            color: white;
        }
        
        .calendar-day .day-price {
            font-size: 9px;
            color: #f59e0b;
            font-weight: bold;
            margin-top: 2px;
        }
        
        .calendar-day.today .day-price,
        .calendar-day.selected .day-price {
            color: #fef3c7;
        }
        
        .calendar-footer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .calendar-price-input {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .calendar-save-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .calendar-save-btn:hover {
            background: #2563eb;
        }
        
        .calendar-save-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .partner-info {
                flex-direction: column;
            }
            
            .partner-details {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .price-calendar {
                min-width: 280px;
                left: -50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ ì¥ì–´ ì£¼ë¬¸ê´€ë¦¬ ì‹œìŠ¤í…œ (ê°œì„ ë²„ì „)</h1>
            <p class="text-gray" id="currentDate"></p>
        </header>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard', this)">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="nav-tab" onclick="showTab('partners', this)">ğŸ‘¥ ê±°ë˜ì²˜ ê´€ë¦¬</button>
            <button class="nav-tab" onclick="showTab('orders', this)">ğŸ“¦ ì„ ì£¼ë¬¸ ê´€ë¦¬</button>
            <button class="nav-tab" onclick="showTab('advance', this)">ğŸ’³ ì™¸ìƒ ê´€ë¦¬</button>
            <button class="nav-tab" onclick="showTab('payments', this)">ğŸ’° ì…ê¸ˆ ê´€ë¦¬</button>
            <button class="nav-tab" onclick="showTab('receipts', this)">ğŸ“¥ ì…ê³  ê´€ë¦¬</button>
            <button class="nav-tab" onclick="showTab('dataView', this)">ğŸ“‹ ê±°ë˜ë‚´ì—­í™•ì¸</button>
        </div>
        
        <!-- ëŒ€ì‹œë³´ë“œ -->
        <div id="dashboard" class="content">
            <div class="grid grid-4" id="statsCards">
                <!-- í†µê³„ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            
            <div class="grid grid-2" style="margin-top: 30px;">
                <div>
                    <h3 style="margin-bottom: 20px;">ê±°ë˜ì²˜ í˜„í™©</h3>
                    <div id="partnersList">
                        <!-- ëª¨ë“  ê±°ë˜ì²˜ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                <div>
                    <h3 style="margin-bottom: 20px;">ë©”ëª¨ ëª©ë¡</h3>
                    <div id="memoList">
                        <!-- ìµœê·¼ ë©”ëª¨ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ê±°ë˜ì²˜ ê´€ë¦¬ -->
        <div id="partners" class="content hide">
            <h3 style="margin-bottom: 20px;" id="partnerFormTitle">ê±°ë˜ì²˜ ë“±ë¡</h3>
            <div class="grid grid-2">
                <div class="form-group">
                    <label>ê±°ë˜ì²˜ëª…</label>
                    <input type="text" id="partnerName" placeholder="ê±°ë˜ì²˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label>ì—°ë½ì²˜</label>
                    <input type="text" id="partnerContact" placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
            </div>
            <input type="hidden" id="partnerEditId" value="">
            <div id="partnerFormButtons">
                <button class="btn btn-success" onclick="addPartner()">ê±°ë˜ì²˜ ë“±ë¡</button>
            </div>
            
            <h3 style="margin: 30px 0 20px 0;">ê±°ë˜ì²˜ ëª©ë¡</h3>
            <div id="partnersListManage">
                <!-- ê±°ë˜ì²˜ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <div class="history-section">
                <h3 style="margin-bottom: 20px;">ğŸ“‹ ê±°ë˜ì²˜ë³„ ì „ì²´ ë‚´ì—­</h3>
                <div class="history-filters">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label>ê±°ë˜ì²˜ ì„ íƒ</label>
                            <select id="historyPartnerSelect" onchange="loadPartnerHistory()">
                                <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê¸°ê°„ í•„í„°</label>
                            <select id="historyPeriodFilter" onchange="loadPartnerHistory()">
                                <option value="all">ì „ì²´ ê¸°ê°„</option>
                                <option value="7">ìµœê·¼ 7ì¼</option>
                                <option value="30">ìµœê·¼ 30ì¼</option>
                                <option value="90">ìµœê·¼ 3ê°œì›”</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="partnerHistoryList">
                    <div class="no-history">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ë©´ ì „ì²´ ê±°ë˜ ë‚´ì—­ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>
        
        <!-- ì„ ì£¼ë¬¸ ê´€ë¦¬ -->
        <div id="orders" class="content hide">
            <h3 style="margin-bottom: 20px;">ì„ ì£¼ë¬¸ ë“±ë¡</h3>
            <div class="grid grid-2">
                <div class="form-group">
                    <label>ê±°ë˜ì²˜</label>
                    <select id="orderPartner">
                        <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì£¼ë¬¸ì¼</label>
                    <input type="date" id="orderDate">
                </div>
                <div class="form-group">
                    <label>ìˆ˜ëŸ‰ (kg)</label>
                    <input type="number" id="orderQuantity" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”" step="0.1">
                </div>
                <div class="form-group">
                    <label>ë‹¨ê°€ (ì›/kg)</label>
                    <input type="number" id="orderPrice" placeholder="ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
            </div>
            <div class="form-group">
                <label>ë¹„ê³ </label>
                <textarea id="orderMemo" placeholder="ë©”ëª¨ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" style="height: 80px;"></textarea>
            </div>
            <div id="orderTotalAmount" style="margin: 10px 0; font-weight: bold; color: #3b82f6;"></div>
            <button class="btn btn-success" onclick="addOrder()">ì„ ì£¼ë¬¸ ë“±ë¡</button>
            
            <div class="history-section">
                <h3 style="margin-bottom: 20px;">ğŸ“‹ ì„ ì£¼ë¬¸ ë‚´ì—­</h3>
                <div class="history-filters">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label>ê±°ë˜ì²˜ í•„í„°</label>
                            <select id="orderHistoryPartner" onchange="loadOrderHistory()">
                                <option value="">ì „ì²´ ê±°ë˜ì²˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê¸°ê°„ í•„í„°</label>
                            <select id="orderHistoryPeriod" onchange="loadOrderHistory()">
                                <option value="all">ì „ì²´ ê¸°ê°„</option>
                                <option value="7">ìµœê·¼ 7ì¼</option>
                                <option value="30">ìµœê·¼ 30ì¼</option>
                                <option value="90">ìµœê·¼ 3ê°œì›”</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="orderHistoryList">
                    <!-- ì„ ì£¼ë¬¸ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        
        <!-- ì™¸ìƒ ê´€ë¦¬ -->
        <div id="advance" class="content hide">
            <h3 style="margin-bottom: 20px;">ì™¸ìƒ ë“±ë¡</h3>
            <div class="grid grid-2">
                <div class="form-group">
                    <label>ê±°ë˜ì²˜</label>
                    <select id="advancePartner">
                        <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì™¸ìƒì¼</label>
                    <input type="date" id="advanceDate">
                </div>
                <div class="form-group">
                    <label>ìˆ˜ëŸ‰ (kg)</label>
                    <input type="number" id="advanceQuantity" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”" step="0.1">
                </div>
                <div class="form-group">
                    <label>ë‹¨ê°€ (ì›/kg)</label>
                    <input type="number" id="advancePrice" placeholder="ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
            </div>
            <div class="form-group">
                <label>ë¹„ê³ </label>
                <textarea id="advanceMemo" placeholder="ë©”ëª¨ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" style="height: 80px;"></textarea>
            </div>
            <div id="advanceTotalAmount" style="margin: 10px 0; font-weight: bold; color: #f59e0b;"></div>
            <button class="btn btn-warning" onclick="addAdvance()">ì™¸ìƒ ë“±ë¡</button>
            
            <div class="history-section">
                <h3 style="margin-bottom: 20px;">ğŸ“‹ ì™¸ìƒ ë‚´ì—­</h3>
                <div class="history-filters">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label>ê±°ë˜ì²˜ í•„í„°</label>
                            <select id="advanceHistoryPartner" onchange="loadAdvanceHistory()">
                                <option value="">ì „ì²´ ê±°ë˜ì²˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê¸°ê°„ í•„í„°</label>
                            <select id="advanceHistoryPeriod" onchange="loadAdvanceHistory()">
                                <option value="all">ì „ì²´ ê¸°ê°„</option>
                                <option value="7">ìµœê·¼ 7ì¼</option>
                                <option value="30">ìµœê·¼ 30ì¼</option>
                                <option value="90">ìµœê·¼ 3ê°œì›”</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="advanceHistoryList">
                    <!-- ì™¸ìƒ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        
        <!-- ì…ê¸ˆ ê´€ë¦¬ -->
        <div id="payments" class="content hide">
            <h3 style="margin-bottom: 20px;">ì…ê¸ˆ ë“±ë¡</h3>
            <div class="grid grid-2">
                <div class="form-group">
                    <label>ê±°ë˜ì²˜</label>
                    <select id="paymentPartner" onchange="updatePaymentInfo()">
                        <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì…ê¸ˆì¼</label>
                    <input type="date" id="paymentDate">
                </div>
                <div class="form-group">
                    <label>ì…ê¸ˆ ìœ í˜•</label>
                    <select id="paymentType" onchange="updatePaymentTypeInfo()">
                        <option value="auto">ìë™ ì •ì‚° (ì™¸ìƒ ìš°ì„ )</option>
                        <option value="advance">ì™¸ìƒë§Œ ì •ì‚°</option>
                        <option value="order">ì„ ì£¼ë¬¸ë§Œ ì •ì‚°</option>
                        <option value="custom">ì§ì ‘ ì§€ì •</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì…ê¸ˆì•¡ (ì›)</label>
                    <input type="number" id="paymentAmount" placeholder="ì…ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”" onchange="calculatePaymentBreakdown()">
                </div>
            </div>
            <div id="customPaymentAllocation" class="grid grid-2" style="display: none; margin-top: 20px;">
                <div class="form-group">
                    <label>ì™¸ìƒ ì •ì‚°ì•¡ (ì›)</label>
                    <input type="number" id="customAdvanceAmount" placeholder="ì™¸ìƒ ì •ì‚°ì•¡" onchange="updateCustomTotal()">
                    <small id="maxAdvanceInfo" class="text-gray"></small>
                </div>
                <div class="form-group">
                    <label>ì„ ì£¼ë¬¸ ì •ì‚°ì•¡ (ì›)</label>
                    <input type="number" id="customOrderAmount" placeholder="ì„ ì£¼ë¬¸ ì •ì‚°ì•¡" onchange="updateCustomTotal()">
                    <small id="maxOrderInfo" class="text-gray"></small>
                </div>
            </div>
            <div class="form-group">
                <label>ë¹„ê³ </label>
                <textarea id="paymentMemo" placeholder="ì…ê¸ˆ ê´€ë ¨ ë©”ëª¨ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" style="height: 80px;"></textarea>
            </div>
            <div id="paymentInfo" class="payment-breakdown" style="display: none;">
                <!-- ì…ê¸ˆ ì •ì‚° ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            <button class="btn btn-success" onclick="addPayment()">ì…ê¸ˆ ë“±ë¡</button>
            
            <div class="history-section">
                <h3 style="margin-bottom: 20px;">ğŸ“‹ ì…ê¸ˆ ë‚´ì—­</h3>
                <div class="history-filters">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label>ê±°ë˜ì²˜ í•„í„°</label>
                            <select id="paymentHistoryPartner" onchange="loadPaymentHistory()">
                                <option value="">ì „ì²´ ê±°ë˜ì²˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê¸°ê°„ í•„í„°</label>
                            <select id="paymentHistoryPeriod" onchange="loadPaymentHistory()">
                                <option value="all">ì „ì²´ ê¸°ê°„</option>
                                <option value="7">ìµœê·¼ 7ì¼</option>
                                <option value="30">ìµœê·¼ 30ì¼</option>
                                <option value="90">ìµœê·¼ 3ê°œì›”</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="paymentHistoryList">
                    <!-- ì…ê¸ˆ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        
        <!-- ì…ê³  ê´€ë¦¬ -->
        <div id="receipts" class="content hide">
            <h3 style="margin-bottom: 20px;">ì…ê³  ë“±ë¡</h3>
            <div class="grid grid-2">
                <div class="form-group">
                    <label>ê±°ë˜ì²˜</label>
                    <select id="receiptPartner">
                        <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì…ê³ ì¼</label>
                    <input type="date" id="receiptDate">
                </div>
                <div class="form-group">
                    <label>ì…ê³ ëŸ‰ (kg)</label>
                    <input type="number" id="receiptQuantity" placeholder="ì…ê³ ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”" step="0.1">
                </div>
            </div>
            <div class="form-group">
                <label>ë¹„ê³ </label>
                <textarea id="receiptMemo" placeholder="ì…ê³  ê´€ë ¨ ë©”ëª¨ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" style="height: 80px;"></textarea>
            </div>
            <button class="btn btn-success" onclick="addReceipt()">ì…ê³  ë“±ë¡</button>
            
            <div class="history-section">
                <h3 style="margin-bottom: 20px;">ğŸ“‹ ì…ê³  ë‚´ì—­</h3>
                <div class="history-filters">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label>ê±°ë˜ì²˜ í•„í„°</label>
                            <select id="receiptHistoryPartner" onchange="loadReceiptHistory()">
                                <option value="">ì „ì²´ ê±°ë˜ì²˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê¸°ê°„ í•„í„°</label>
                            <select id="receiptHistoryPeriod" onchange="loadReceiptHistory()">
                                <option value="all">ì „ì²´ ê¸°ê°„</option>
                                <option value="7">ìµœê·¼ 7ì¼</option>
                                <option value="30">ìµœê·¼ 30ì¼</option>
                                <option value="90">ìµœê·¼ 3ê°œì›”</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="receiptHistoryList">
                    <!-- ì…ê³  ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì €ì¥ëœ ì •ë³´ í™•ì¸ -->
        <div id="dataView" class="content hide">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">ğŸ“‹ ê±°ë˜ë‚´ì—­í™•ì¸</h3>
                <div>
                    <button class="btn btn-success" onclick="exportFilteredData()" style="padding: 8px 16px; font-size: 14px;">ğŸ“„ ì¶œë ¥</button>
                </div>
            </div>

            <!-- í•„í„° ì„¹ì…˜ -->
            <div class="card" style="margin-bottom: 20px;">
                <h4 style="margin-bottom: 15px;">ğŸ” ë°ì´í„° í•„í„°</h4>
                <div class="grid grid-4">
                    <div class="form-group">
                        <label>ë°ì´í„° ìœ í˜•</label>
                        <select id="dataTypeFilter" onchange="filterData()">
                            <option value="all">ì „ì²´</option>
                            <option value="partners">ê±°ë˜ì²˜</option>
                            <option value="orders">ì„ ì£¼ë¬¸</option>
                            <option value="advances">ì™¸ìƒ</option>
                            <option value="payments">ì…ê¸ˆ</option>
                            <option value="receipts">ì…ê³ </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ê±°ë˜ì²˜ í•„í„°</label>
                        <select id="dataPartnerFilter" onchange="filterData()">
                            <option value="">ì „ì²´ ê±°ë˜ì²˜</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ì‹œì‘ ë‚ ì§œ</label>
                        <input type="date" id="dataStartDate" onchange="filterData()">
                    </div>
                    <div class="form-group">
                        <label>ì¢…ë£Œ ë‚ ì§œ</label>
                        <input type="date" id="dataEndDate" onchange="filterData()">
                    </div>
                </div>
            </div>

            <!-- ë°ì´í„° í‘œì‹œ ì„¹ì…˜ -->
            <div id="dataViewContainer">
                <!-- í•„í„°ëœ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let partners = [];        // ê±°ë˜ì²˜ ëª©ë¡
        let orders = [];         // ì„ ì£¼ë¬¸ ëª©ë¡
        let advances = [];       // ì™¸ìƒ ëª©ë¡
        let payments = [];       // ì…ê¸ˆ ëª©ë¡
        let receipts = [];       // ì…ê³  ëª©ë¡
        let partnerStatus = new Map(); // ê±°ë˜ì²˜ë³„ ìƒíƒœ (ì„ ì£¼ë¬¸ ì¤„ëˆ, ì™¸ìƒ ì¤„ëˆ, ë°›ì„ì¥ì–´)

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ì €ì¥ëœ ë°ì´í„° ë¡œë“œ
            loadData();
            
            updateCurrentDate();
            setTodayDates();
            updateAllSelects();
            setupCalculators();
            
            // ëŒ€ì‹œë³´ë“œë¥¼ ì—¬ëŸ¬ ë²ˆ ì—…ë°ì´íŠ¸
            updateDashboard();
            setTimeout(() => {
                updateDashboard();
            }, 100);
            setTimeout(() => {
                updateDashboard();
            }, 500);
        });

        // í˜„ì¬ ë‚ ì§œ í‘œì‹œ
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('ko-KR', options);
        }

        // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì • (í•œêµ­ì‹œê°„ ê¸°ì¤€)
        function setTodayDates() {
            const today = new Date();
            // í•œêµ­ì‹œê°„ìœ¼ë¡œ ë³€í™˜ (UTC+9)
            const kstOffset = 9 * 60; // 9ì‹œê°„ì„ ë¶„ìœ¼ë¡œ ë³€í™˜
            const kstTime = new Date(today.getTime() + (kstOffset * 60 * 1000));
            const todayKST = kstTime.toISOString().split('T')[0];
            
            document.getElementById('orderDate').value = todayKST;
            document.getElementById('advanceDate').value = todayKST;
            document.getElementById('paymentDate').value = todayKST;
            document.getElementById('receiptDate').value = todayKST;
        }

        // ê³„ì‚°ê¸° ì„¤ì •
        function setupCalculators() {
            ['orderQuantity', 'orderPrice'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculateOrderTotal);
            });
            ['advanceQuantity', 'advancePrice'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculateAdvanceTotal);
            });
        }

        // ì„ ì£¼ë¬¸ ì´ì•¡ ê³„ì‚°
        function calculateOrderTotal() {
            const quantity = parseFloat(document.getElementById('orderQuantity').value) || 0;
            const price = parseFloat(document.getElementById('orderPrice').value) || 0;
            const total = quantity * price;
            
            const totalElement = document.getElementById('orderTotalAmount');
            if (total > 0) {
                totalElement.textContent = `ì´ ê¸ˆì•¡: ${formatCurrency(total)}`;
            } else {
                totalElement.textContent = '';
            }
        }

        // ì™¸ìƒ ì´ì•¡ ê³„ì‚°
        function calculateAdvanceTotal() {
            const quantity = parseFloat(document.getElementById('advanceQuantity').value) || 0;
            const price = parseFloat(document.getElementById('advancePrice').value) || 0;
            const total = quantity * price;
            
            const totalElement = document.getElementById('advanceTotalAmount');
            if (total > 0) {
                totalElement.textContent = `ì´ ê¸ˆì•¡: ${formatCurrency(total)}`;
            } else {
                totalElement.textContent = '';
            }
        }

        // ë°ì´í„° ë¡œë“œ
        function loadData() {
            try {
                const savedData = localStorage.getItem('eelOrderDataV2');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    partners = data.partners || [];
                    orders = data.orders || [];
                    advances = data.advances || [];
                    payments = data.payments || [];
                    receipts = data.receipts || [];
                    
                    // ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
                    if (data.partnerStatus) {
                        partnerStatus = new Map(Object.entries(data.partnerStatus));
                    } else {
                        calculatePartnerStatus();
                    }
                } else {
                    // ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´ˆê¸° ë°ì´í„°ë¡œ ì„¤ì •
                    initializeData();
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                initializeData();
            }
        }

        // ë°ì´í„° ì´ˆê¸°í™” (ìŠ¤í¬ë¦°ìƒ· ë°ì´í„° í¬í•¨)
        function initializeData() {
            partners = [
                {
                    id: 'partner_seungduyeong',
                    name: 'ìŠ¹ë‘ì˜',
                    phone: '',
                    address: '',
                    createdAt: '2025-08-29T09:00:00.000Z'
                },
                {
                    id: 'partner_hwangsil',
                    name: 'í™©ì‹¤ë¶„ì ',
                    phone: '',
                    address: '',
                    createdAt: '2025-08-23T09:00:00.000Z'
                }
            ];
            
            orders = [
                {
                    id: 'order_seungduyeong_001',
                    partnerId: 'partner_seungduyeong',
                    partnerName: 'ìŠ¹ë‘ì˜',
                    quantity: 150,
                    pricePerKg: 28000,
                    totalAmount: 4200000,
                    date: '2025-08-29',
                    memo: 'ì˜¤ëŠ˜ 30í‚¤ë¡œ ë‚´ê°€ ë°›ì•„ì„œ 150 í‚¤ë¡œë‚¨ìŒ',
                    status: 'pending'
                }
            ];
            
            advances = [
                {
                    id: 'advance_hwangsil_001',
                    partnerId: 'partner_hwangsil',
                    partnerName: 'í™©ì‹¤ë¶„ì ',
                    quantity: 0,
                    pricePerKg: 0,
                    totalAmount: 8702500,
                    date: '2025-08-23',
                    memo: 'ì™¸ìƒìœ¼ë¡œ ê¸ˆì•¡ ë§ë“œë¼ ìˆ˜ì •í•œê±°ì„ ì™¸ìƒ 8702500 ì´ë¬ìŒ',
                    status: 'pending'
                }
            ];
            
            payments = [];
            receipts = [];
            
            // ê±°ë˜ì²˜ ìƒíƒœ ê³„ì‚°
            partnerStatus = new Map();
            partnerStatus.set('partner_seungduyeong', {
                pending_payment_order: 4600000,
                pending_payment_advance: 0,
                pending_eel_kg: 150
            });
            partnerStatus.set('partner_hwangsil', {
                pending_payment_order: 0,
                pending_payment_advance: 8702500,
                pending_eel_kg: 0
            });
            
            // ê°€ê²© ì •ë³´ ì €ì¥
            localStorage.setItem('partnerPrice_partner_seungduyeong', '28000');
            
            // ë°ì´í„° ì €ì¥
            saveData();
            
            // ì¦‰ì‹œ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
            updateDashboard();
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            try {
                const data = { 
                    partners, 
                    orders, 
                    advances, 
                    payments, 
                    receipts,
                    partnerStatus: Object.fromEntries(partnerStatus)
                };
                localStorage.setItem('eelOrderDataV2', JSON.stringify(data));
            } catch (error) {
                console.error('ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê±°ë˜ì²˜ ìƒíƒœ ê³„ì‚°
        function calculatePartnerStatus() {
            partnerStatus.clear();
            
            partners.forEach(partner => {
                partnerStatus.set(partner.id, {
                    pending_payment_order: 0,    // ì„ ì£¼ë¬¸ ì¤„ëˆ
                    pending_payment_advance: 0,  // ì™¸ìƒ ì¤„ëˆ
                    pending_eel_kg: 0            // ë°›ì„ì¥ì–´
                });
            });
            
            // ì„ ì£¼ë¬¸ ì²˜ë¦¬
            orders.forEach(order => {
                const status = partnerStatus.get(order.partnerId);
                if (status) {
                    status.pending_payment_order += order.totalAmount;
                    status.pending_eel_kg += order.quantity;
                }
            });
            
            // ì™¸ìƒ ì²˜ë¦¬
            advances.forEach(advance => {
                const status = partnerStatus.get(advance.partnerId);
                if (status) {
                    status.pending_payment_advance += advance.totalAmount;
                    status.pending_eel_kg += advance.quantity;
                }
            });
            
            // ì…ê¸ˆ ì²˜ë¦¬ (ì‹ ê·œ ë°ì´í„° êµ¬ì¡° ì‚¬ìš©)
            payments.forEach(payment => {
                const status = partnerStatus.get(payment.partnerId);
                if (status) {
                    // ì‹ ê·œ ì…ê¸ˆ ë°ì´í„°ì— ì •ì‚° ì •ë³´ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
                    if (payment.advancePayment !== undefined && payment.orderPayment !== undefined) {
                        status.pending_payment_advance -= payment.advancePayment;
                        status.pending_payment_order -= payment.orderPayment;
                    } else {
                        // ê¸°ì¡´ ë°ì´í„°ëŠ” ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ (ì™¸ìƒ ìš°ì„ )
                        let remainingAmount = payment.amount;
                        
                        // ì™¸ìƒ ì¤„ëˆì—ì„œ ë¨¼ì € ì°¨ê°
                        if (status.pending_payment_advance > 0 && remainingAmount > 0) {
                            const advancePayment = Math.min(status.pending_payment_advance, remainingAmount);
                            status.pending_payment_advance -= advancePayment;
                            remainingAmount -= advancePayment;
                        }
                        
                        // ë‚¨ì€ ê¸ˆì•¡ì„ ì„ ì£¼ë¬¸ ì¤„ëˆì—ì„œ ì°¨ê°
                        if (status.pending_payment_order > 0 && remainingAmount > 0) {
                            const orderPayment = Math.min(status.pending_payment_order, remainingAmount);
                            status.pending_payment_order -= orderPayment;
                        }
                        
                        // ìŒìˆ˜ ë°©ì§€
                        if (status.pending_payment_advance < 0) status.pending_payment_advance = 0;
                        if (status.pending_payment_order < 0) status.pending_payment_order = 0;
                    }
                }
            });
            
            // ì…ê³  ì²˜ë¦¬
            receipts.forEach(receipt => {
                const status = partnerStatus.get(receipt.partnerId);
                if (status) {
                    status.pending_eel_kg -= receipt.quantity;
                    // ìŒìˆ˜ ë°©ì§€
                    if (status.pending_eel_kg < 0) status.pending_eel_kg = 0;
                }
            });
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ko-KR').format(amount) + 'ì›';
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('ko-KR');
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        // ì…ë ¥ê°’ ê²€ì¦ í•¨ìˆ˜
        function validateNumericInput(value, fieldName, min = 0, max = Number.MAX_SAFE_INTEGER) {
            const numValue = parseFloat(value);
            if (isNaN(numValue)) {
                throw new Error(`${fieldName}ì€(ëŠ”) ìœ íš¨í•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);
            }
            if (numValue < min) {
                throw new Error(`${fieldName}ì€(ëŠ”) ${min} ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);
            }
            if (numValue > max) {
                throw new Error(`${fieldName}ì€(ëŠ”) ${max} ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);
            }
            return numValue;
        }
        
        function validateStringInput(value, fieldName, maxLength = 255) {
            const trimmedValue = value.trim();
            if (!trimmedValue) {
                throw new Error(`${fieldName}ì„(ë¥¼) ì…ë ¥í•´ì£¼ì„¸ìš”.`);
            }
            if (trimmedValue.length > maxLength) {
                throw new Error(`${fieldName}ì€(ëŠ”) ${maxLength}ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
            }
            return trimmedValue;
        }
        
        function validateDateInput(dateValue, fieldName) {
            if (!dateValue) {
                throw new Error(`${fieldName}ì„(ë¥¼) ì„ íƒí•´ì£¼ì„¸ìš”.`);
            }
            const date = new Date(dateValue);
            if (isNaN(date.getTime())) {
                throw new Error(`${fieldName}ì´(ê°€) ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`);
            }
            // ë¯¸ë˜ ë‚ ì§œ ì œí•œ (í•„ìš”ì‹œ)
            const today = new Date();
            const maxDate = new Date(today.getFullYear() + 1, today.getMonth(), today.getDate());
            if (date > maxDate) {
                throw new Error(`${fieldName}ì€(ëŠ”) 1ë…„ ì´ë‚´ ë‚ ì§œì—¬ì•¼ í•©ë‹ˆë‹¤.`);
            }
            return dateValue;
        }
        
        // ê±°ë˜ì²˜ë³„ ë‹¨ê°€ ì €ì¥ (ëŒ€ì‹œë³´ë“œ ì „ìš©)
        function savePartnerPrice(partnerId, price) {
            const numPrice = parseFloat(price);
            if (price && !isNaN(numPrice) && numPrice > 0) {
                localStorage.setItem(`partnerPrice_${partnerId}`, numPrice.toString());
            } else if (price === '' || price === null || price === undefined) {
                localStorage.removeItem(`partnerPrice_${partnerId}`);
            }
        }
        
        // ë‚ ì§œë³„ ë‹¨ê°€ ë‹¬ë ¥ ê´€ë ¨ í•¨ìˆ˜ë“¤
        let currentCalendarPartnerId = null;
        let currentCalendarDate = new Date();
        let selectedCalendarDate = null;
        
        // ë‹¬ë ¥ í† ê¸€
        function togglePriceCalendar(partnerId) {
            const calendar = document.getElementById(`priceCalendar_${partnerId}`);
            const isVisible = calendar.style.display === 'block';
            
            // ëª¨ë“  ë‹¬ë ¥ ë‹«ê¸°
            document.querySelectorAll('.price-calendar').forEach(cal => {
                cal.style.display = 'none';
            });
            
            if (!isVisible) {
                currentCalendarPartnerId = partnerId;
                currentCalendarDate = new Date();
                selectedCalendarDate = new Date();
                renderPriceCalendar(partnerId);
                calendar.style.display = 'block';
                
                // í´ë¦­ ì™¸ë¶€ ì˜ì—­ ê°ì§€ë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                setTimeout(() => {
                    document.addEventListener('click', closePriceCalendarOnOutsideClick);
                }, 100);
            } else {
                document.removeEventListener('click', closePriceCalendarOnOutsideClick);
            }
        }
        
        // ì™¸ë¶€ í´ë¦­ ì‹œ ë‹¬ë ¥ ë‹«ê¸°
        function closePriceCalendarOnOutsideClick(event) {
            if (!event.target.closest('.price-calendar-container')) {
                document.querySelectorAll('.price-calendar').forEach(cal => {
                    cal.style.display = 'none';
                });
                document.removeEventListener('click', closePriceCalendarOnOutsideClick);
            }
        }
        
        // ë‹¬ë ¥ ë Œë”ë§
        function renderPriceCalendar(partnerId) {
            const calendar = document.getElementById(`priceCalendar_${partnerId}`);
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const today = new Date();
            const todayStr = formatDateKey(today);
            const selectedStr = selectedCalendarDate ? formatDateKey(selectedCalendarDate) : todayStr;
            
            let calendarHTML = `
                <div class="calendar-header">
                    <button class="calendar-nav-btn" onclick="navigateCalendar('${partnerId}', -1)">â—€</button>
                    <div class="calendar-month-year">${year}ë…„ ${month + 1}ì›”</div>
                    <button class="calendar-nav-btn" onclick="navigateCalendar('${partnerId}', 1)">â–¶</button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-header">ì¼</div>
                    <div class="calendar-day-header">ì›”</div>
                    <div class="calendar-day-header">í™”</div>
                    <div class="calendar-day-header">ìˆ˜</div>
                    <div class="calendar-day-header">ëª©</div>
                    <div class="calendar-day-header">ê¸ˆ</div>
                    <div class="calendar-day-header">í† </div>
            `;
            
            // 6ì£¼ í‘œì‹œ
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + (week * 7 + day));
                    
                    const dateStr = formatDateKey(currentDate);
                    const dayNum = currentDate.getDate();
                    const isCurrentMonth = currentDate.getMonth() === month;
                    const isToday = dateStr === todayStr;
                    const isSelected = dateStr === selectedStr;
                    
                    // í•´ë‹¹ ë‚ ì§œì˜ ì €ì¥ëœ ê°€ê²© ê°€ì ¸ì˜¤ê¸°
                    const savedPrice = getDayPrice(partnerId, dateStr);
                    const priceDisplay = savedPrice ? `${parseInt(savedPrice).toLocaleString()}` : '';
                    
                    let dayClass = 'calendar-day';
                    if (!isCurrentMonth) dayClass += ' other-month';
                    if (isToday) dayClass += ' today';
                    if (isSelected) dayClass += ' selected';
                    
                    calendarHTML += `
                        <div class="${dayClass}" onclick="selectCalendarDate('${partnerId}', '${dateStr}')">
                            <div>${dayNum}</div>
                            ${priceDisplay ? `<div class="day-price">${priceDisplay}</div>` : ''}
                        </div>
                    `;
                }
            }
            
            // ì„ íƒëœ ë‚ ì§œì˜ ê°€ê²© í‘œì‹œ ë° ì…ë ¥
            const selectedPrice = getDayPrice(partnerId, selectedStr) || '';
            const selectedDateDisplay = selectedCalendarDate ? 
                `${selectedCalendarDate.getMonth() + 1}/${selectedCalendarDate.getDate()}` : 
                `${today.getMonth() + 1}/${today.getDate()}`;
            
            calendarHTML += `
                </div>
                <div class="calendar-footer">
                    <label style="font-size: 12px; color: #374151; white-space: nowrap;">${selectedDateDisplay} ë‹¨ê°€:</label>
                    <input 
                        type="number" 
                        class="calendar-price-input" 
                        placeholder="ì›/kg"
                        value="${selectedPrice}"
                        id="calendarPriceInput_${partnerId}"
                    >
                    <button 
                        class="calendar-save-btn" 
                        onclick="saveDayPrice('${partnerId}', '${selectedStr}')"
                    >
                        ì €ì¥
                    </button>
                </div>
            `;
            
            calendar.innerHTML = calendarHTML;
        }
        
        // ë‹¬ë ¥ ë„¤ë¹„ê²Œì´ì…˜
        function navigateCalendar(partnerId, direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            renderPriceCalendar(partnerId);
        }
        
        // ë‚ ì§œ ì„ íƒ
        function selectCalendarDate(partnerId, dateStr) {
            selectedCalendarDate = parseDateKey(dateStr);
            renderPriceCalendar(partnerId);
        }
        
        // ë‚ ì§œë³„ ê°€ê²© ì €ì¥
        function saveDayPrice(partnerId, dateStr) {
            const input = document.getElementById(`calendarPriceInput_${partnerId}`);
            const price = input.value.trim();
            
            if (price && !isNaN(parseFloat(price)) && parseFloat(price) > 0) {
                localStorage.setItem(`dayPrice_${partnerId}_${dateStr}`, price);
                
                // ì˜¤ëŠ˜ ë‚ ì§œë©´ ë©”ì¸ ë‹¨ê°€ ì…ë ¥ í•„ë“œë„ ì—…ë°ì´íŠ¸
                const today = formatDateKey(new Date());
                if (dateStr === today) {
                    const mainPriceInput = document.querySelector(`input[onchange="savePartnerPrice('${partnerId}', this.value)"]`);
                    if (mainPriceInput) {
                        mainPriceInput.value = price;
                        savePartnerPrice(partnerId, price);
                    }
                }
            } else if (price === '') {
                localStorage.removeItem(`dayPrice_${partnerId}_${dateStr}`);
            }
            
            renderPriceCalendar(partnerId);
        }
        
        // ë‚ ì§œë³„ ê°€ê²© ì¡°íšŒ
        function getDayPrice(partnerId, dateStr) {
            return localStorage.getItem(`dayPrice_${partnerId}_${dateStr}`);
        }
        
        // ë‚ ì§œ í‚¤ í¬ë§· (YYYY-MM-DD)
        function formatDateKey(date) {
            return date.getFullYear() + '-' + 
                   String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                   String(date.getDate()).padStart(2, '0');
        }
        
        // ë‚ ì§œ í‚¤ íŒŒì‹±
        function parseDateKey(dateStr) {
            const parts = dateStr.split('-');
            return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
        }

        // íƒ­ ì „í™˜
        function showTab(tabName, targetElement) {
            // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.content').forEach(content => {
                content.classList.add('hide');
            });
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í‘œì‹œ
            document.getElementById(tabName).classList.remove('hide');
            
            // í´ë¦­ëœ íƒ­ ë²„íŠ¼ í™œì„±í™”
            if (targetElement) {
                targetElement.classList.add('active');
            } else {
                // íƒ­ ì´ë¦„ìœ¼ë¡œ ë²„íŠ¼ ì°¾ê¸° (í”„ë¡œê·¸ë˜ë°ì  í˜¸ì¶œìš©)
                const tabButtons = document.querySelectorAll('.nav-tab');
                tabButtons.forEach(button => {
                    if (button.textContent.includes(getTabDisplayName(tabName))) {
                        button.classList.add('active');
                    }
                });
            }
            
            // íƒ­ë³„ ì—…ë°ì´íŠ¸
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'partners') {
                updatePartnersManageList();
                updateHistorySelects();
            } else {
                updateAllSelects();
                if (tabName === 'orders') loadOrderHistory();
                if (tabName === 'advance') loadAdvanceHistory();
                if (tabName === 'payments') loadPaymentHistory();
                if (tabName === 'receipts') loadReceiptHistory();
                if (tabName === 'dataView') initializeDataView();
            }
        }
        
        // íƒ­ ì´ë¦„ ë§¤í•‘
        function getTabDisplayName(tabName) {
            const tabNames = {
                'dashboard': 'ëŒ€ì‹œë³´ë“œ',
                'partners': 'ê±°ë˜ì²˜ ê´€ë¦¬',
                'orders': 'ì„ ì£¼ë¬¸ ê´€ë¦¬',
                'advance': 'ì™¸ìƒ ê´€ë¦¬',
                'payments': 'ì…ê¸ˆ ê´€ë¦¬',
                'receipts': 'ì…ê³  ê´€ë¦¬',
                'dataView': 'ê±°ë˜ë‚´ì—­í™•ì¸'
            };
            return tabNames[tabName] || tabName;
        }

        // ëª¨ë“  ì…€ë ‰íŠ¸ ì—…ë°ì´íŠ¸
        function updateAllSelects() {
            updateOrderSelects();
            updateAdvanceSelects();
            updatePaymentSelects();
            updateReceiptSelects();
            updateHistorySelects();
        }
        
        // ë‚´ì—­ ì¡°íšŒìš© ì…€ë ‰íŠ¸ ì—…ë°ì´íŠ¸
        function updateHistorySelects() {
            // ê±°ë˜ì²˜ ê´€ë¦¬ì˜ ë‚´ì—­ ì…€ë ‰íŠ¸
            const historyPartnerSelect = document.getElementById('historyPartnerSelect');
            if (historyPartnerSelect) {
                historyPartnerSelect.innerHTML = '<option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                partners.forEach(partner => {
                    const option = document.createElement('option');
                    option.value = partner.id;
                    option.textContent = partner.name;
                    historyPartnerSelect.appendChild(option);
                });
            }
            
            // ì„ ì£¼ë¬¸ ë‚´ì—­ í•„í„°
            const orderHistoryPartner = document.getElementById('orderHistoryPartner');
            if (orderHistoryPartner) {
                orderHistoryPartner.innerHTML = '<option value="">ì „ì²´ ê±°ë˜ì²˜</option>';
                partners.forEach(partner => {
                    const option = document.createElement('option');
                    option.value = partner.id;
                    option.textContent = partner.name;
                    orderHistoryPartner.appendChild(option);
                });
            }
            
            // ì™¸ìƒ ë‚´ì—­ í•„í„°
            const advanceHistoryPartner = document.getElementById('advanceHistoryPartner');
            if (advanceHistoryPartner) {
                advanceHistoryPartner.innerHTML = '<option value="">ì „ì²´ ê±°ë˜ì²˜</option>';
                partners.forEach(partner => {
                    const option = document.createElement('option');
                    option.value = partner.id;
                    option.textContent = partner.name;
                    advanceHistoryPartner.appendChild(option);
                });
            }
            
            // ì…ê¸ˆ ë‚´ì—­ í•„í„°
            const paymentHistoryPartner = document.getElementById('paymentHistoryPartner');
            if (paymentHistoryPartner) {
                paymentHistoryPartner.innerHTML = '<option value="">ì „ì²´ ê±°ë˜ì²˜</option>';
                partners.forEach(partner => {
                    const option = document.createElement('option');
                    option.value = partner.id;
                    option.textContent = partner.name;
                    paymentHistoryPartner.appendChild(option);
                });
            }
            
            // ì…ê³  ë‚´ì—­ í•„í„°
            const receiptHistoryPartner = document.getElementById('receiptHistoryPartner');
            if (receiptHistoryPartner) {
                receiptHistoryPartner.innerHTML = '<option value="">ì „ì²´ ê±°ë˜ì²˜</option>';
                partners.forEach(partner => {
                    const option = document.createElement('option');
                    option.value = partner.id;
                    option.textContent = partner.name;
                    receiptHistoryPartner.appendChild(option);
                });
            }
        }

        // ì„ ì£¼ë¬¸ ì…€ë ‰íŠ¸ ì—…ë°ì´íŠ¸
        function updateOrderSelects() {
            const select = document.getElementById('orderPartner');
            select.innerHTML = '<option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            partners.forEach(partner => {
                const option = document.createElement('option');
                option.value = partner.id;
                option.textContent = partner.name;
                select.appendChild(option);
            });
        }

        // ì™¸ìƒ ì…€ë ‰íŠ¸ ì—…ë°ì´íŠ¸
        function updateAdvanceSelects() {
            const select = document.getElementById('advancePartner');
            select.innerHTML = '<option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            partners.forEach(partner => {
                const option = document.createElement('option');
                option.value = partner.id;
                option.textContent = partner.name;
                select.appendChild(option);
            });
        }

        // ì…ê¸ˆ ì…€ë ‰íŠ¸ ì—…ë°ì´íŠ¸
        function updatePaymentSelects() {
            const select = document.getElementById('paymentPartner');
            select.innerHTML = '<option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            
            partners.forEach(partner => {
                const status = partnerStatus.get(partner.id);
                if (status && (status.pending_payment_order > 0 || status.pending_payment_advance > 0)) {
                    const option = document.createElement('option');
                    option.value = partner.id;
                    const advanceText = status.pending_payment_advance > 0 ? ` (ì™¸ìƒ: ${formatCurrency(status.pending_payment_advance)})` : '';
                    option.textContent = partner.name + advanceText;
                    select.appendChild(option);
                }
            });
        }

        // ì…ê³  ì…€ë ‰íŠ¸ ì—…ë°ì´íŠ¸
        function updateReceiptSelects() {
            const select = document.getElementById('receiptPartner');
            select.innerHTML = '<option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            
            partners.forEach(partner => {
                const status = partnerStatus.get(partner.id);
                if (status && status.pending_eel_kg > 0) {
                    const option = document.createElement('option');
                    option.value = partner.id;
                    option.textContent = `${partner.name} - ë°›ì„ì¥ì–´: ${status.pending_eel_kg}kg`;
                    select.appendChild(option);
                }
            });
        }

        // ì…ê¸ˆ ì •ë³´ ì—…ë°ì´íŠ¸
        function updatePaymentInfo() {
            const partnerId = document.getElementById('paymentPartner').value;
            const infoDiv = document.getElementById('paymentInfo');
            
            if (!partnerId) {
                infoDiv.style.display = 'none';
                document.getElementById('customPaymentAllocation').style.display = 'none';
                return;
            }
            
            const status = partnerStatus.get(partnerId);
            if (!status) {
                infoDiv.style.display = 'none';
                return;
            }
            
            // ìµœëŒ€ ì •ì‚° ê°€ëŠ¥ ê¸ˆì•¡ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('maxAdvanceInfo').textContent = `ìµœëŒ€: ${formatCurrency(status.pending_payment_advance)}`;
            document.getElementById('maxOrderInfo').textContent = `ìµœëŒ€: ${formatCurrency(status.pending_payment_order)}`;
            
            updatePaymentTypeInfo();
        }
        
        // ì…ê¸ˆ ìœ í˜• ë³€ê²½ ì‹œ ì •ë³´ ì—…ë°ì´íŠ¸
        function updatePaymentTypeInfo() {
            const partnerId = document.getElementById('paymentPartner').value;
            const paymentType = document.getElementById('paymentType').value;
            const infoDiv = document.getElementById('paymentInfo');
            const customDiv = document.getElementById('customPaymentAllocation');
            
            if (!partnerId) {
                infoDiv.style.display = 'none';
                customDiv.style.display = 'none';
                return;
            }
            
            const status = partnerStatus.get(partnerId);
            if (!status) {
                infoDiv.style.display = 'none';
                customDiv.style.display = 'none';
                return;
            }
            
            // ì»¤ìŠ¤í…€ ì…ë ¥ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
            if (paymentType === 'custom') {
                customDiv.style.display = 'grid';
            } else {
                customDiv.style.display = 'none';
                // ì»¤ìŠ¤í…€ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('customAdvanceAmount').value = '';
                document.getElementById('customOrderAmount').value = '';
            }
            
            // ê¸°ë³¸ ì •ë³´ í‘œì‹œ
            let infoText = `
                <strong>í˜„ì¬ ì”ì•¡ ì •ë³´:</strong><br>
                â€¢ ì™¸ìƒ ì¤„ëˆ: ${formatCurrency(status.pending_payment_advance)}<br>
                â€¢ ì„ ì£¼ë¬¸ ì¤„ëˆ: ${formatCurrency(status.pending_payment_order)}<br>
                â€¢ ì´ ì¤„ëˆ: ${formatCurrency(status.pending_payment_advance + status.pending_payment_order)}<br><br>
            `;
            
            // ì…ê¸ˆ ìœ í˜•ë³„ ì•ˆë‚´ ë©”ì‹œì§€
            switch(paymentType) {
                case 'auto':
                    infoText += '<strong>ğŸ”„ ìë™ ì •ì‚°:</strong> ì™¸ìƒì„ ë¨¼ì € ì •ì‚°í•˜ê³ , ë‚¨ì€ ê¸ˆì•¡ìœ¼ë¡œ ì„ ì£¼ë¬¸ì„ ì •ì‚°í•©ë‹ˆë‹¤.';
                    break;
                case 'advance':
                    infoText += '<strong>ğŸ’³ ì™¸ìƒë§Œ ì •ì‚°:</strong> ì…ê¸ˆì•¡ ì „ì²´ë¥¼ ì™¸ìƒ ì •ì‚°ì—ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.';
                    break;
                case 'order':
                    infoText += '<strong>ğŸ“¦ ì„ ì£¼ë¬¸ë§Œ ì •ì‚°:</strong> ì…ê¸ˆì•¡ ì „ì²´ë¥¼ ì„ ì£¼ë¬¸ ì •ì‚°ì—ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.';
                    break;
                case 'custom':
                    infoText += '<strong>âœï¸ ì§ì ‘ ì§€ì •:</strong> ì™¸ìƒê³¼ ì„ ì£¼ë¬¸ ì •ì‚°ì•¡ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.';
                    break;
            }
            
            infoDiv.innerHTML = infoText;
            infoDiv.style.display = 'block';
            
            // ì…ê¸ˆì•¡ì´ ì…ë ¥ë˜ì–´ ìˆìœ¼ë©´ ì •ì‚° ë‚´ì—­ ê³„ì‚°
            if (document.getElementById('paymentAmount').value) {
                calculatePaymentBreakdown();
            }
        }
        
        // ì»¤ìŠ¤í…€ ì´ì•¡ ì—…ë°ì´íŠ¸
        function updateCustomTotal() {
            const advanceAmount = parseFloat(document.getElementById('customAdvanceAmount').value) || 0;
            const orderAmount = parseFloat(document.getElementById('customOrderAmount').value) || 0;
            const totalAmount = advanceAmount + orderAmount;
            
            document.getElementById('paymentAmount').value = totalAmount;
            calculatePaymentBreakdown();
        }

        // ì…ê¸ˆ ì •ì‚° ë‚´ì—­ ê³„ì‚°
        function calculatePaymentBreakdown() {
            const partnerId = document.getElementById('paymentPartner').value;
            const amount = parseFloat(document.getElementById('paymentAmount').value) || 0;
            const paymentType = document.getElementById('paymentType').value;
            const infoDiv = document.getElementById('paymentInfo');
            
            if (!partnerId || amount <= 0) {
                updatePaymentTypeInfo();
                return;
            }
            
            const status = partnerStatus.get(partnerId);
            if (!status) return;
            
            let advancePayment = 0;
            let orderPayment = 0;
            let remainingAmount = amount;
            
            switch (paymentType) {
                case 'auto':
                    // ì™¸ìƒ ìš°ì„  ì •ì‚°
                    if (status.pending_payment_advance > 0 && remainingAmount > 0) {
                        advancePayment = Math.min(status.pending_payment_advance, remainingAmount);
                        remainingAmount -= advancePayment;
                    }
                    // ì„ ì£¼ë¬¸ ì •ì‚°
                    if (status.pending_payment_order > 0 && remainingAmount > 0) {
                        orderPayment = Math.min(status.pending_payment_order, remainingAmount);
                        remainingAmount -= orderPayment;
                    }
                    break;
                    
                case 'advance':
                    // ì™¸ìƒë§Œ ì •ì‚°
                    if (status.pending_payment_advance > 0) {
                        advancePayment = Math.min(status.pending_payment_advance, amount);
                        remainingAmount = amount - advancePayment;
                    } else {
                        remainingAmount = amount;
                    }
                    break;
                    
                case 'order':
                    // ì„ ì£¼ë¬¸ë§Œ ì •ì‚°
                    if (status.pending_payment_order > 0) {
                        orderPayment = Math.min(status.pending_payment_order, amount);
                        remainingAmount = amount - orderPayment;
                    } else {
                        remainingAmount = amount;
                    }
                    break;
                    
                case 'custom':
                    // ì§ì ‘ ì§€ì •ëœ ê¸ˆì•¡ ì‚¬ìš©
                    const customAdvanceAmount = parseFloat(document.getElementById('customAdvanceAmount').value) || 0;
                    const customOrderAmount = parseFloat(document.getElementById('customOrderAmount').value) || 0;
                    
                    advancePayment = Math.min(customAdvanceAmount, status.pending_payment_advance);
                    orderPayment = Math.min(customOrderAmount, status.pending_payment_order);
                    remainingAmount = amount - advancePayment - orderPayment;
                    break;
            }
            
            // ì •ì‚° í›„ ìƒíƒœ ê³„ì‚°
            const afterAdvance = status.pending_payment_advance - advancePayment;
            const afterOrder = status.pending_payment_order - orderPayment;
            
            let infoText = `
                <strong>ì…ê¸ˆ ${formatCurrency(amount)} ì •ì‚° ë‚´ì—­:</strong><br>
                â€¢ ì™¸ìƒ ì •ì‚°: ${formatCurrency(advancePayment)}<br>
                â€¢ ì„ ì£¼ë¬¸ ì •ì‚°: ${formatCurrency(orderPayment)}<br>
                ${remainingAmount > 0 ? `â€¢ ì´ˆê³¼ ì…ê¸ˆ: ${formatCurrency(remainingAmount)}<br>` : ''}
                ${remainingAmount < 0 ? `â€¢ ë¶€ì¡± ê¸ˆì•¡: ${formatCurrency(Math.abs(remainingAmount))}<br>` : ''}
                <br>
                <strong>ì •ì‚° í›„ ì”ì•¡:</strong><br>
                â€¢ ì™¸ìƒ ì¤„ëˆ: ${formatCurrency(afterAdvance)}<br>
                â€¢ ì„ ì£¼ë¬¸ ì¤„ëˆ: ${formatCurrency(afterOrder)}
            `;
            
            infoDiv.innerHTML = infoText;
            infoDiv.style.display = 'block';
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            calculatePartnerStatus();
            
            // í†µê³„ ê³„ì‚°
            let totalOrderDebt = 0;
            let totalAdvanceDebt = 0;
            let totalPendingEel = 0;
            let warningPartners = 0;
            
            partnerStatus.forEach((status, partnerId) => {
                totalOrderDebt += status.pending_payment_order;
                totalAdvanceDebt += status.pending_payment_advance;
                totalPendingEel += status.pending_eel_kg;
                
                if (status.pending_payment_order > 0 || status.pending_payment_advance > 0 || status.pending_eel_kg > 0) {
                    warningPartners++;
                }
            });

            // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('statsCards').innerHTML = `
                <div class="card stats-card red">
                    <div class="detail-label">ì„ ì£¼ë¬¸ ì¤„ëˆ</div>
                    <div class="stats-number">${formatCurrency(totalOrderDebt)}</div>
                </div>
                <div class="card stats-card orange">
                    <div class="detail-label">ì™¸ìƒ ì¤„ëˆ</div>
                    <div class="stats-number">${formatCurrency(totalAdvanceDebt)}</div>
                </div>
                <div class="card stats-card purple">
                    <div class="detail-label">ë°›ì„ì¥ì–´</div>
                    <div class="stats-number">${totalPendingEel}kg</div>
                </div>
                <div class="card stats-card green">
                    <div class="detail-label">ì£¼ìš”ê±°ë˜ì²˜</div>
                    <div class="stats-number">${warningPartners}ê°œ</div>
                </div>
            `;

            // ì „ì²´ ê±°ë˜ì²˜ ëª©ë¡ í‘œì‹œ
            updatePartnersList();
            
            // ë©”ëª¨ ëª©ë¡ í‘œì‹œ
            updateMemoList();
        }

        // ë©”ëª¨ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateMemoList() {
            const container = document.getElementById('memoList');
            const allMemos = [];
            
            // ì„ ì£¼ë¬¸ ë©”ëª¨ ìˆ˜ì§‘
            orders.forEach(order => {
                if (order.memo) {
                    const partner = partners.find(p => p.id === order.partnerId);
                    allMemos.push({
                        id: order.id,
                        type: 'ì„ ì£¼ë¬¸',
                        date: order.date,
                        partner: partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜',
                        memo: order.memo,
                        color: 'text-blue'
                    });
                }
            });
            
            // ì™¸ìƒ ë©”ëª¨ ìˆ˜ì§‘
            advances.forEach(advance => {
                if (advance.memo) {
                    const partner = partners.find(p => p.id === advance.partnerId);
                    allMemos.push({
                        id: advance.id,
                        type: 'ì™¸ìƒ',
                        date: advance.date,
                        partner: partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜',
                        memo: advance.memo,
                        color: 'text-orange'
                    });
                }
            });
            
            // ì…ê¸ˆ ë©”ëª¨ ìˆ˜ì§‘
            payments.forEach(payment => {
                if (payment.memo) {
                    const partner = partners.find(p => p.id === payment.partnerId);
                    allMemos.push({
                        id: payment.id,
                        type: 'ì…ê¸ˆ',
                        date: payment.date,
                        partner: partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜',
                        memo: payment.memo,
                        color: 'text-green'
                    });
                }
            });
            
            // ì…ê³  ë©”ëª¨ ìˆ˜ì§‘
            receipts.forEach(receipt => {
                if (receipt.memo) {
                    const partner = partners.find(p => p.id === receipt.partnerId);
                    allMemos.push({
                        id: receipt.id,
                        type: 'ì…ê³ ',
                        date: receipt.date,
                        partner: partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜',
                        memo: receipt.memo,
                        color: 'text-purple'
                    });
                }
            });
            
            // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  10ê°œë§Œ)
            allMemos.sort((a, b) => new Date(b.date) - new Date(a.date));
            const recentMemos = allMemos.slice(0, 10);
            
            if (recentMemos.length === 0) {
                container.innerHTML = '<div class="text-center text-gray">ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = recentMemos.map((memo, index) => `
                <div class="card" style="padding: 15px; margin-bottom: 10px; border-left: 4px solid #e5e7eb;" id="memo-${memo.type}-${memo.id || index}">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                        <span class="${memo.color}" style="font-weight: bold; font-size: 0.875rem;">[${memo.type}] ${memo.partner}</span>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="text-gray" style="font-size: 0.75rem;">${formatDate(memo.date)}</span>
                            <button class="delete-btn" onclick="deleteMemoFromDashboard('${memo.type}', '${memo.id}', this)" title="ë©”ëª¨ë§Œ ì‚­ì œ" style="padding: 4px 6px; font-size: 0.75rem;">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                    <div style="font-size: 0.875rem; line-height: 1.4;">${memo.memo}</div>
                </div>
            `).join('');
        }
        
        // ëŒ€ì‹œë³´ë“œì—ì„œ ë©”ëª¨ ì‚­ì œ
        function deleteMemoFromDashboard(type, itemId, buttonElement) {
            if (!confirm('ì´ ë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€» ë©”ëª¨ë§Œ ì‚­ì œë˜ê³  ê±°ë˜ ë‚´ì—­ì€ ìœ ì§€ë©ë‹ˆë‹¤.')) {
                return;
            }
            
            let found = false;
            
            // í•´ë‹¹ ê±°ë˜ ë‚´ì—­ì—ì„œ ë©”ëª¨ë§Œ ì‚­ì œ
            switch (type) {
                case 'ì„ ì£¼ë¬¸':
                    const orderIndex = orders.findIndex(o => o.id === itemId);
                    if (orderIndex !== -1) {
                        orders[orderIndex].memo = '';
                        found = true;
                    }
                    break;
                case 'ì™¸ìƒ':
                    const advanceIndex = advances.findIndex(a => a.id === itemId);
                    if (advanceIndex !== -1) {
                        advances[advanceIndex].memo = '';
                        found = true;
                    }
                    break;
                case 'ì…ê¸ˆ':
                    const paymentIndex = payments.findIndex(p => p.id === itemId);
                    if (paymentIndex !== -1) {
                        payments[paymentIndex].memo = '';
                        found = true;
                    }
                    break;
                case 'ì…ê³ ':
                    const receiptIndex = receipts.findIndex(r => r.id === itemId);
                    if (receiptIndex !== -1) {
                        receipts[receiptIndex].memo = '';
                        found = true;
                    }
                    break;
            }
            
            if (found) {
                // ë°ì´í„° ì €ì¥
                saveData();
                
                // ë©”ëª¨ ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ì œê±°
                const memoCard = buttonElement.closest('.card');
                memoCard.style.transition = 'opacity 0.3s, transform 0.3s';
                memoCard.style.opacity = '0';
                memoCard.style.transform = 'translateX(100px)';
                
                // ì• ë‹ˆë©”ì´ì…˜ í›„ ë©”ëª¨ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    updateMemoList();
                }, 300);
                
                alert('ë©”ëª¨ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('í•´ë‹¹ ë©”ëª¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì „ì²´ ê±°ë˜ì²˜ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updatePartnersList() {
            const container = document.getElementById('partnersList');
            
            if (partners.length === 0) {
                container.innerHTML = '<div class="text-center text-gray">ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = partners.map(partner => {
                const status = partnerStatus.get(partner.id) || {
                    pending_payment_order: 0,
                    pending_payment_advance: 0,
                    pending_eel_kg: 0
                };
                return createPartnerCard(partner, status, false);
            }).join('');
        }

        // ê±°ë˜ì²˜ ì¹´ë“œ ìƒì„±
        function createPartnerCard(partner, status, isWarning) {
            const totalDebt = status.pending_payment_order + status.pending_payment_advance;
            const hasAdvance = status.pending_payment_advance > 0;
            const cardClass = isWarning ? 'warning' : (totalDebt === 0 && status.pending_eel_kg === 0 ? 'completed' : '');
            
            // ê±°ë˜ì²˜ë³„ ì €ì¥ëœ ë‹¨ê°€ ë¶ˆëŸ¬ì˜¤ê¸° (ì˜¤ëŠ˜ ë‚ ì§œ ìš°ì„ , ì—†ìœ¼ë©´ ê¸°ë³¸ ë‹¨ê°€)
            const todayKey = formatDateKey(new Date());
            const todayPrice = localStorage.getItem(`dayPrice_${partner.id}_${todayKey}`);
            const savedPrice = todayPrice || localStorage.getItem(`partnerPrice_${partner.id}`) || '';
            
            return `
                <div class="card partner-card ${cardClass}">
                    <div class="partner-info">
                        <div>
                            <div class="partner-name">
                                ${partner.name}
                                ${hasAdvance ? `<span class="advance-indicator">ì™¸ìƒ: ${formatCurrency(status.pending_payment_advance)}</span>` : ''}
                            </div>
                            ${partner.contact ? `<div class="text-gray" style="font-size: 0.875rem;">ğŸ“ ${partner.contact}</div>` : ''}
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button class="delete-btn" onclick="deletePartner('${partner.id}', '${partner.name}')" title="ê±°ë˜ì²˜ ì‚­ì œ">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                    
                    <!-- ë‹¨ê°€ ì…ë ¥ í•„ë“œ ì¶”ê°€ -->
                    <div style="margin: 15px 0; padding: 10px; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="font-size: 0.875rem; font-weight: 600; color: #374151; min-width: 80px;">ì¥ì–´ ë‹¨ê°€:</label>
                            <input 
                                type="number" 
                                value="${savedPrice}" 
                                placeholder="ì›/kg" 
                                style="flex: 1; padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.875rem; max-width: 120px;"
                                onchange="savePartnerPrice('${partner.id}', this.value)"
                                onblur="savePartnerPrice('${partner.id}', this.value)"
                            >
                            <span style="font-size: 0.75rem; color: #6b7280;">ì›/kg</span>
                            <div class="price-calendar-container">
                                <button 
                                    type="button"
                                    onclick="togglePriceCalendar('${partner.id}')"
                                    style="background: #3b82f6; color: white; border: none; padding: 6px 8px; border-radius: 4px; cursor: pointer; font-size: 0.75rem;"
                                    title="ë‚ ì§œë³„ ë‹¨ê°€ ë³´ê¸°"
                                >
                                    ğŸ“…
                                </button>
                                <div id="priceCalendar_${partner.id}" class="price-calendar">
                                    <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="partner-details">
                        <div class="detail-item">
                            <div class="detail-label">ë°›ì„ì¥ì–´</div>
                            <div class="detail-value ${status.pending_eel_kg > 0 ? 'text-purple' : 'text-green'}">${status.pending_eel_kg}kg</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ì„ ì£¼ë¬¸ ì¤„ëˆ</div>
                            <div class="detail-value ${status.pending_payment_order > 0 ? 'text-red' : 'text-green'}">${formatCurrency(status.pending_payment_order)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ì™¸ìƒ ì¤„ëˆ</div>
                            <div class="detail-value ${status.pending_payment_advance > 0 ? 'text-orange' : 'text-green'}">${formatCurrency(status.pending_payment_advance)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ì´ ì¤„ëˆ</div>
                            <div class="detail-value ${totalDebt > 0 ? 'text-red' : 'text-green'}">${formatCurrency(totalDebt)}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ê±°ë˜ì²˜ ê´€ë¦¬ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updatePartnersManageList() {
            const container = document.getElementById('partnersListManage');
            if (partners.length === 0) {
                container.innerHTML = '<div class="text-center text-gray">ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = partners.map(partner => `
                <div class="card">
                    <div class="partner-info">
                        <div>
                            <div class="partner-name">${partner.name}</div>
                            <div class="text-gray">${partner.contact || 'ì—°ë½ì²˜ ì—†ìŒ'}</div>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="editPartner('${partner.id}')" style="margin-right: 10px;">ìˆ˜ì •</button>
                            <button class="btn btn-danger" onclick="deletePartner('${partner.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ê±°ë˜ì²˜ ì¶”ê°€
        function addPartner() {
            try {
                const name = validateStringInput(
                    document.getElementById('partnerName').value, 
                    'ê±°ë˜ì²˜ëª…', 
                    50
                );
                const contact = document.getElementById('partnerContact').value.trim();
                
                // ì¤‘ë³µ ê±°ë˜ì²˜ëª… ê²€ì‚¬
                if (partners.some(p => p.name === name)) {
                    throw new Error('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê±°ë˜ì²˜ëª…ì…ë‹ˆë‹¤.');
                }
                
                // ì—°ë½ì²˜ ê²€ì¦ (ì„ íƒì‚¬í•­ì´ë¯€ë¡œ ê°’ì´ ìˆì„ ë•Œë§Œ)
                if (contact && contact.length > 20) {
                    throw new Error('ì—°ë½ì²˜ëŠ” 20ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                
                const partner = {
                    id: generateId(),
                    name,
                    contact
                };
                
                partners.push(partner);
                
                // ê±°ë˜ì²˜ ìƒíƒœ ì´ˆê¸°í™”
                partnerStatus.set(partner.id, {
                    pending_payment_order: 0,
                    pending_payment_advance: 0,
                    pending_eel_kg: 0
                });
                
                saveData();
                updateAllSelects();
                updatePartnersManageList();
                updateDashboard();
                
                // í˜„ì¬ íƒ­ì´ ê±°ë˜ì²˜ ê´€ë¦¬ë¼ë©´ ë‚´ì—­ë„ ìƒˆë¡œê³ ì¹¨
                const activeTab = document.querySelector('.nav-tab.active');
                if (activeTab && activeTab.textContent.includes('ê±°ë˜ì²˜ ê´€ë¦¬')) {
                    loadPartnerHistory();
                }
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('partnerName').value = '';
                document.getElementById('partnerContact').value = '';
                
                alert('ê±°ë˜ì²˜ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert(error.message);
            }
        }

        // ê±°ë˜ì²˜ ìˆ˜ì • ëª¨ë“œ í™œì„±í™”
        function editPartner(id) {
            const partner = partners.find(p => p.id === id);
            if (!partner) {
                alert('ê±°ë˜ì²˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í¼ì— ê¸°ì¡´ ë°ì´í„° ì…ë ¥
            document.getElementById('partnerName').value = partner.name;
            document.getElementById('partnerContact').value = partner.contact || '';
            document.getElementById('partnerEditId').value = id;
            
            // ì œëª©ê³¼ ë²„íŠ¼ ë³€ê²½
            document.getElementById('partnerFormTitle').textContent = 'ê±°ë˜ì²˜ ìˆ˜ì •';
            document.getElementById('partnerFormButtons').innerHTML = `
                <button class="btn btn-success" onclick="updatePartner()">ìˆ˜ì • ì™„ë£Œ</button>
                <button class="btn btn-secondary" onclick="cancelEdit()" style="margin-left: 10px;">ì·¨ì†Œ</button>
            `;
            
            // ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('partnerFormTitle').scrollIntoView({ behavior: 'smooth' });
        }

        // ê±°ë˜ì²˜ ìˆ˜ì • ì™„ë£Œ
        function updatePartner() {
            try {
                const editId = document.getElementById('partnerEditId').value;
                const name = validateStringInput(
                    document.getElementById('partnerName').value, 
                    'ê±°ë˜ì²˜ëª…', 
                    50
                );
                const contact = document.getElementById('partnerContact').value.trim();
                
                if (!editId) {
                    alert('ìˆ˜ì •í•  ê±°ë˜ì²˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // ê¸°ì¡´ ê±°ë˜ì²˜ì™€ ì´ë¦„ ì¤‘ë³µ ì²´í¬ (ìê¸° ìì‹  ì œì™¸)
                if (partners.some(p => p.id !== editId && p.name === name)) {
                    throw new Error('ì´ë¯¸ ë“±ë¡ëœ ê±°ë˜ì²˜ëª…ì…ë‹ˆë‹¤.');
                }
                
                // ê±°ë˜ì²˜ ì •ë³´ ì—…ë°ì´íŠ¸
                const partnerIndex = partners.findIndex(p => p.id === editId);
                if (partnerIndex === -1) {
                    alert('ê±°ë˜ì²˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                partners[partnerIndex].name = name;
                partners[partnerIndex].contact = contact;
                
                saveData();
                updateAllSelects();
                updatePartnersManageList();
                updateDashboard();
                
                // í˜„ì¬ íƒ­ì´ ê±°ë˜ì²˜ ê´€ë¦¬ë¼ë©´ ë‚´ì—­ë„ ìƒˆë¡œê³ ì¹¨
                const activeTab = document.querySelector('.nav-tab.active');
                if (activeTab && activeTab.textContent.includes('ê±°ë˜ì²˜ ê´€ë¦¬')) {
                    loadPartnerHistory();
                }
                
                // ìˆ˜ì • ëª¨ë“œ ì¢…ë£Œ
                cancelEdit();
                
                alert('ê±°ë˜ì²˜ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert(error.message);
            }
        }

        // ìˆ˜ì • ëª¨ë“œ ì·¨ì†Œ
        function cancelEdit() {
            // í¼ ì´ˆê¸°í™”
            document.getElementById('partnerName').value = '';
            document.getElementById('partnerContact').value = '';
            document.getElementById('partnerEditId').value = '';
            
            // ì œëª©ê³¼ ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ
            document.getElementById('partnerFormTitle').textContent = 'ê±°ë˜ì²˜ ë“±ë¡';
            document.getElementById('partnerFormButtons').innerHTML = `
                <button class="btn btn-success" onclick="addPartner()">ê±°ë˜ì²˜ ë“±ë¡</button>
            `;
        }

        // ê±°ë˜ì²˜ ì‚­ì œ (ê±°ë˜ ë‚´ì—­ì€ ë³´ì¡´)
        function deletePartner(id, name) {
            if (confirm(`${name || 'ì´ ê±°ë˜ì²˜'}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì£¼ì˜: ê±°ë˜ì²˜ëŠ” ì‚­ì œë˜ì§€ë§Œ ê±°ë˜ ë‚´ì—­ì€ ë³´ì¡´ë©ë‹ˆë‹¤.`)) {
                // ê±°ë˜ì²˜ë§Œ ì‚­ì œ, ê±°ë˜ ë‚´ì—­ì€ ë³´ì¡´
                partners = partners.filter(p => p.id !== id);
                partnerStatus.delete(id);
                
                saveData();
                updateAllSelects();
                updatePartnersManageList();
                updateDashboard();
                loadPartnerHistory();
            }
        }

        // ì„ ì£¼ë¬¸ ì¶”ê°€
        function addOrder() {
            try {
                const partnerId = document.getElementById('orderPartner').value;
                if (!partnerId) {
                    throw new Error('ê±°ë˜ì²˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }
                
                const date = validateDateInput(
                    document.getElementById('orderDate').value, 
                    'ì£¼ë¬¸ì¼'
                );
                
                const quantity = validateNumericInput(
                    document.getElementById('orderQuantity').value, 
                    'ìˆ˜ëŸ‰', 
                    0.1, 
                    99999
                );
                
                const pricePerKg = validateNumericInput(
                    document.getElementById('orderPrice').value, 
                    'ë‹¨ê°€', 
                    1, 
                    999999
                );
                
                const memo = document.getElementById('orderMemo').value.trim();
                if (memo.length > 500) {
                    throw new Error('ë¹„ê³ ëŠ” 500ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                
                const totalAmount = quantity * pricePerKg;
                
                const order = {
                    id: generateId(),
                    partnerId,
                    date,
                    quantity,
                    pricePerKg,
                    totalAmount,
                    memo
                };
                
                orders.push(order);
                
                // ê±°ë˜ì²˜ ìƒíƒœ ì—…ë°ì´íŠ¸
                const status = partnerStatus.get(partnerId);
                if (status) {
                    status.pending_payment_order += totalAmount;
                    status.pending_eel_kg += quantity;
                }
                
                saveData();
                updateAllSelects();
                updateDashboard();
                loadOrderHistory();
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('orderPartner').value = '';
                document.getElementById('orderQuantity').value = '';
                document.getElementById('orderPrice').value = '';
                document.getElementById('orderMemo').value = '';
                document.getElementById('orderTotalAmount').textContent = '';
                
                alert('ì„ ì£¼ë¬¸ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert(error.message);
            }
        }

        // ì™¸ìƒ ì¶”ê°€
        function addAdvance() {
            try {
                const partnerId = document.getElementById('advancePartner').value;
                if (!partnerId) {
                    throw new Error('ê±°ë˜ì²˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }
                
                const date = validateDateInput(
                    document.getElementById('advanceDate').value, 
                    'ì™¸ìƒì¼'
                );
                
                const quantity = validateNumericInput(
                    document.getElementById('advanceQuantity').value, 
                    'ìˆ˜ëŸ‰', 
                    0.1, 
                    99999
                );
                
                const pricePerKg = validateNumericInput(
                    document.getElementById('advancePrice').value, 
                    'ë‹¨ê°€', 
                    1, 
                    999999
                );
                
                const memo = document.getElementById('advanceMemo').value.trim();
                if (memo.length > 500) {
                    throw new Error('ë¹„ê³ ëŠ” 500ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                
                const totalAmount = quantity * pricePerKg;
                
                const advance = {
                    id: generateId(),
                    partnerId,
                    date,
                    quantity,
                    pricePerKg,
                    totalAmount,
                    memo
                };
                
                advances.push(advance);
                
                // ê±°ë˜ì²˜ ìƒíƒœ ì—…ë°ì´íŠ¸
                const status = partnerStatus.get(partnerId);
                if (status) {
                    status.pending_payment_advance += totalAmount;
                    status.pending_eel_kg += quantity;
                }
                
                saveData();
                updateAllSelects();
                updateDashboard();
                loadAdvanceHistory();
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('advancePartner').value = '';
                document.getElementById('advanceQuantity').value = '';
                document.getElementById('advancePrice').value = '';
                document.getElementById('advanceMemo').value = '';
                document.getElementById('advanceTotalAmount').textContent = '';
                
                alert('ì™¸ìƒì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert(error.message);
            }
        }

        // ì…ê¸ˆ ì¶”ê°€
        function addPayment() {
            try {
                const partnerId = document.getElementById('paymentPartner').value;
                if (!partnerId) {
                    throw new Error('ê±°ë˜ì²˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }
                
                const date = validateDateInput(
                    document.getElementById('paymentDate').value, 
                    'ì…ê¸ˆì¼'
                );
                
                const amount = validateNumericInput(
                    document.getElementById('paymentAmount').value, 
                    'ì…ê¸ˆì•¡', 
                    1, 
                    99999999
                );
                
                const paymentType = document.getElementById('paymentType').value;
                const memo = document.getElementById('paymentMemo').value.trim();
                if (memo.length > 500) {
                    throw new Error('ë¹„ê³ ëŠ” 500ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                
                const status = partnerStatus.get(partnerId);
                if (!status) {
                    throw new Error('ê±°ë˜ì²˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            
            // ì…ê¸ˆ ìœ í˜•ë³„ ì •ì‚° ê¸ˆì•¡ ê³„ì‚°
            let advancePayment = 0;
            let orderPayment = 0;
            let remainingAmount = amount;
            
            switch (paymentType) {
                case 'auto':
                    // ì™¸ìƒ ìš°ì„  ì •ì‚°
                    if (status.pending_payment_advance > 0 && remainingAmount > 0) {
                        advancePayment = Math.min(status.pending_payment_advance, remainingAmount);
                        remainingAmount -= advancePayment;
                    }
                    // ì„ ì£¼ë¬¸ ì •ì‚°
                    if (status.pending_payment_order > 0 && remainingAmount > 0) {
                        orderPayment = Math.min(status.pending_payment_order, remainingAmount);
                        remainingAmount -= orderPayment;
                    }
                    break;
                    
                case 'advance':
                    // ì™¸ìƒë§Œ ì •ì‚°
                    if (status.pending_payment_advance > 0) {
                        advancePayment = Math.min(status.pending_payment_advance, amount);
                        remainingAmount = amount - advancePayment;
                    }
                    break;
                    
                case 'order':
                    // ì„ ì£¼ë¬¸ë§Œ ì •ì‚°
                    if (status.pending_payment_order > 0) {
                        orderPayment = Math.min(status.pending_payment_order, amount);
                        remainingAmount = amount - orderPayment;
                    }
                    break;
                    
                case 'custom':
                    // ì§ì ‘ ì§€ì •ëœ ê¸ˆì•¡ ì‚¬ìš©
                    const customAdvanceAmount = parseFloat(document.getElementById('customAdvanceAmount').value) || 0;
                    const customOrderAmount = parseFloat(document.getElementById('customOrderAmount').value) || 0;
                    
                            if (customAdvanceAmount + customOrderAmount !== amount) {
                        throw new Error('ì™¸ìƒ ì •ì‚°ì•¡ + ì„ ì£¼ë¬¸ ì •ì‚°ì•¡ì´ ì…ê¸ˆì•¡ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                    
                    if (customAdvanceAmount > status.pending_payment_advance) {
                        throw new Error('ì™¸ìƒ ì •ì‚°ì•¡ì´ ì‹¤ì œ ì™¸ìƒ ê¸ˆì•¡ë³´ë‹¤ í½ë‹ˆë‹¤.');
                    }
                    
                    if (customOrderAmount > status.pending_payment_order) {
                        throw new Error('ì„ ì£¼ë¬¸ ì •ì‚°ì•¡ì´ ì‹¤ì œ ì„ ì£¼ë¬¸ ê¸ˆì•¡ë³´ë‹¤ í½ë‹ˆë‹¤.');
                    }
                    
                    advancePayment = customAdvanceAmount;
                    orderPayment = customOrderAmount;
                    remainingAmount = 0;
                    break;
            }
            
            // ì…ê¸ˆ ë‚´ì—­ ì €ì¥ (ì •ì‚° ìƒì„¸ ì •ë³´ í¬í•¨)
            const payment = {
                id: generateId(),
                partnerId,
                date,
                amount,
                paymentType,
                advancePayment,
                orderPayment,
                remainingAmount,
                memo
            };
            
            payments.push(payment);
            
            // ê±°ë˜ì²˜ ìƒíƒœ ì—…ë°ì´íŠ¸
            status.pending_payment_advance -= advancePayment;
            status.pending_payment_order -= orderPayment;
            
            saveData();
            updateAllSelects();
            updateDashboard();
            loadPaymentHistory();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('paymentPartner').value = '';
            document.getElementById('paymentAmount').value = '';
            document.getElementById('paymentMemo').value = '';
            document.getElementById('paymentType').value = 'auto';
            document.getElementById('customAdvanceAmount').value = '';
            document.getElementById('customOrderAmount').value = '';
            document.getElementById('paymentInfo').style.display = 'none';
            document.getElementById('customPaymentAllocation').style.display = 'none';
            
            let alertMessage = 'ì…ê¸ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n';
            alertMessage += `ì™¸ìƒ ì •ì‚°: ${formatCurrency(advancePayment)}\n`;
            alertMessage += `ì„ ì£¼ë¬¸ ì •ì‚°: ${formatCurrency(orderPayment)}`;
            if (remainingAmount > 0) {
                alertMessage += `\nì´ˆê³¼ ì…ê¸ˆ: ${formatCurrency(remainingAmount)}`;
            }
            
                alert(alertMessage);
            } catch (error) {
                alert(error.message);
            }
        }

        // ì…ê³  ì¶”ê°€
        function addReceipt() {
            try {
                const partnerId = document.getElementById('receiptPartner').value;
                if (!partnerId) {
                    throw new Error('ê±°ë˜ì²˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }
                
                const date = validateDateInput(
                    document.getElementById('receiptDate').value, 
                    'ì…ê³ ì¼'
                );
                
                const quantity = validateNumericInput(
                    document.getElementById('receiptQuantity').value, 
                    'ì…ê³ ëŸ‰', 
                    0.1, 
                    99999
                );
                
                const memo = document.getElementById('receiptMemo').value.trim();
                if (memo.length > 500) {
                    throw new Error('ë¹„ê³ ëŠ” 500ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                
                const receipt = {
                    id: generateId(),
                    partnerId,
                    date,
                    quantity,
                    memo
                };
                
                receipts.push(receipt);
                
                // ê±°ë˜ì²˜ ìƒíƒœ ì—…ë°ì´íŠ¸
                const status = partnerStatus.get(partnerId);
                if (status) {
                    status.pending_eel_kg -= quantity;
                    // ìŒìˆ˜ ë°©ì§€
                    if (status.pending_eel_kg < 0) status.pending_eel_kg = 0;
                }
                
                saveData();
                updateAllSelects();
                updateDashboard();
                loadReceiptHistory();
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('receiptPartner').value = '';
                document.getElementById('receiptQuantity').value = '';
                document.getElementById('receiptMemo').value = '';
                
                alert('ì…ê³ ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert(error.message);
            }
        }

        // ì…ê¸ˆ ë‚´ì—­ ë¡œë“œ
        function loadPaymentHistory() {
            const partnerFilter = document.getElementById('paymentHistoryPartner').value;
            const periodFilter = document.getElementById('paymentHistoryPeriod').value;
            const container = document.getElementById('paymentHistoryList');
            
            let filteredPayments = payments;
            
            // ê±°ë˜ì²˜ í•„í„° ì ìš©
            if (partnerFilter) {
                filteredPayments = filteredPayments.filter(payment => payment.partnerId === partnerFilter);
            }
            
            // ê¸°ê°„ í•„í„° ì ìš©
            if (periodFilter !== 'all') {
                const days = parseInt(periodFilter);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                filteredPayments = filteredPayments.filter(payment => new Date(payment.date) >= cutoffDate);
            }
            
            // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            filteredPayments.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredPayments.length === 0) {
                container.innerHTML = '<div class="text-center text-gray">ì…ê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = filteredPayments.map(payment => {
                const partner = partners.find(p => p.id === payment.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                
                // ì…ê¸ˆ ìœ í˜• í‘œì‹œ
                let paymentTypeText = '';
                switch(payment.paymentType) {
                    case 'auto': paymentTypeText = 'ğŸ”„ ìë™ì •ì‚°'; break;
                    case 'advance': paymentTypeText = 'ğŸ’³ ì™¸ìƒì •ì‚°'; break;
                    case 'order': paymentTypeText = 'ğŸ“¦ ì„ ì£¼ë¬¸ì •ì‚°'; break;
                    case 'custom': paymentTypeText = 'âœï¸ ì§ì ‘ì§€ì •'; break;
                    default: paymentTypeText = 'ğŸ”„ ìë™ì •ì‚°'; break;
                }
                
                // ì •ì‚° ìƒì„¸ ì •ë³´ (ì‹ ê·œ ì…ê¸ˆ ë‚´ì—­ì—ë§Œ ìˆìŒ)
                let settlementInfo = '';
                if (payment.advancePayment !== undefined && payment.orderPayment !== undefined) {
                    settlementInfo = `
                        <div class="payment-breakdown" style="margin-top: 10px;">
                            <strong>ì •ì‚° ìƒì„¸:</strong><br>
                            â€¢ ì™¸ìƒ ì •ì‚°: ${formatCurrency(payment.advancePayment || 0)}<br>
                            â€¢ ì„ ì£¼ë¬¸ ì •ì‚°: ${formatCurrency(payment.orderPayment || 0)}
                            ${payment.remainingAmount > 0 ? `<br>â€¢ ì´ˆê³¼ ì…ê¸ˆ: ${formatCurrency(payment.remainingAmount)}` : ''}
                        </div>
                    `;
                }
                
                return `
                    <div class="card" style="margin-bottom: 15px; border-left: 4px solid #10b981;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: bold; color: #1f2937; margin-bottom: 5px;">
                                    ${partnerName} 
                                    <span style="background: #dcfce7; color: #166534; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; margin-left: 5px;">
                                        ${paymentTypeText}
                                    </span>
                                </div>
                                <div class="text-gray" style="font-size: 0.875rem;">${formatDate(payment.date)}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #10b981;">
                                    ${formatCurrency(payment.amount)}
                                </div>
                                <button class="delete-btn" onclick="deletePayment('${payment.id}')" title="ì…ê¸ˆ ë‚´ì—­ ì‚­ì œ">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                        ${settlementInfo}
                        ${payment.memo ? `<div style="margin-top: 10px; padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.875rem;">${payment.memo}</div>` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // ì„ ì£¼ë¬¸ ë‚´ì—­ ë¡œë“œ 
        function loadOrderHistory() {
            const partnerFilter = document.getElementById('orderHistoryPartner').value;
            const periodFilter = document.getElementById('orderHistoryPeriod').value;
            const container = document.getElementById('orderHistoryList');
            
            let filteredOrders = orders;
            
            // ê±°ë˜ì²˜ í•„í„° ì ìš©
            if (partnerFilter) {
                filteredOrders = filteredOrders.filter(order => order.partnerId === partnerFilter);
            }
            
            // ê¸°ê°„ í•„í„° ì ìš©
            if (periodFilter !== 'all') {
                const days = parseInt(periodFilter);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                filteredOrders = filteredOrders.filter(order => new Date(order.date) >= cutoffDate);
            }
            
            // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            filteredOrders.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredOrders.length === 0) {
                container.innerHTML = '<div class="text-center text-gray">ì„ ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = filteredOrders.map(order => {
                const partner = partners.find(p => p.id === order.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                
                return `
                    <div class="card" style="margin-bottom: 15px; border-left: 4px solid #3b82f6;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: bold; color: #1f2937; margin-bottom: 5px;">${partnerName}</div>
                                <div class="text-gray" style="font-size: 0.875rem;">${formatDate(order.date)}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #3b82f6;">
                                    ${formatCurrency(order.totalAmount)}
                                </div>
                                <button class="delete-btn" onclick="deleteOrder('${order.id}')" title="ì„ ì£¼ë¬¸ ì‚­ì œ">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px;">
                            <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                <div class="text-gray" style="font-size: 0.75rem;">ìˆ˜ëŸ‰</div>
                                <div style="font-weight: bold;">${order.quantity}kg</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                <div class="text-gray" style="font-size: 0.75rem;">ë‹¨ê°€</div>
                                <div style="font-weight: bold;">${formatCurrency(order.pricePerKg)}/kg</div>
                            </div>
                        </div>
                        ${order.memo ? `<div style="padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.875rem;">${order.memo}</div>` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // ì™¸ìƒ ë‚´ì—­ ë¡œë“œ
        function loadAdvanceHistory() {
            const partnerFilter = document.getElementById('advanceHistoryPartner').value;
            const periodFilter = document.getElementById('advanceHistoryPeriod').value;
            const container = document.getElementById('advanceHistoryList');
            
            let filteredAdvances = advances;
            
            // ê±°ë˜ì²˜ í•„í„° ì ìš©
            if (partnerFilter) {
                filteredAdvances = filteredAdvances.filter(advance => advance.partnerId === partnerFilter);
            }
            
            // ê¸°ê°„ í•„í„° ì ìš©
            if (periodFilter !== 'all') {
                const days = parseInt(periodFilter);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                filteredAdvances = filteredAdvances.filter(advance => new Date(advance.date) >= cutoffDate);
            }
            
            // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            filteredAdvances.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredAdvances.length === 0) {
                container.innerHTML = '<div class="text-center text-gray">ì™¸ìƒ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = filteredAdvances.map(advance => {
                const partner = partners.find(p => p.id === advance.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                
                return `
                    <div class="card" style="margin-bottom: 15px; border-left: 4px solid #f59e0b;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: bold; color: #1f2937; margin-bottom: 5px;">${partnerName}</div>
                                <div class="text-gray" style="font-size: 0.875rem;">${formatDate(advance.date)}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #f59e0b;">
                                    ${formatCurrency(advance.totalAmount)}
                                </div>
                                <button class="delete-btn" onclick="deleteAdvance('${advance.id}')" title="ì™¸ìƒ ì‚­ì œ">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px;">
                            <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                <div class="text-gray" style="font-size: 0.75rem;">ìˆ˜ëŸ‰</div>
                                <div style="font-weight: bold;">${advance.quantity}kg</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                <div class="text-gray" style="font-size: 0.75rem;">ë‹¨ê°€</div>
                                <div style="font-weight: bold;">${formatCurrency(advance.pricePerKg)}/kg</div>
                            </div>
                        </div>
                        ${advance.memo ? `<div style="padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.875rem;">${advance.memo}</div>` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // ì…ê³  ë‚´ì—­ ë¡œë“œ
        function loadReceiptHistory() {
            const partnerFilter = document.getElementById('receiptHistoryPartner').value;
            const periodFilter = document.getElementById('receiptHistoryPeriod').value;
            const container = document.getElementById('receiptHistoryList');
            
            let filteredReceipts = receipts;
            
            // ê±°ë˜ì²˜ í•„í„° ì ìš©
            if (partnerFilter) {
                filteredReceipts = filteredReceipts.filter(receipt => receipt.partnerId === partnerFilter);
            }
            
            // ê¸°ê°„ í•„í„° ì ìš©
            if (periodFilter !== 'all') {
                const days = parseInt(periodFilter);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                filteredReceipts = filteredReceipts.filter(receipt => new Date(receipt.date) >= cutoffDate);
            }
            
            // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            filteredReceipts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredReceipts.length === 0) {
                container.innerHTML = '<div class="text-center text-gray">ì…ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = filteredReceipts.map(receipt => {
                const partner = partners.find(p => p.id === receipt.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                
                return `
                    <div class="card" style="margin-bottom: 15px; border-left: 4px solid #8b5cf6;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: bold; color: #1f2937; margin-bottom: 5px;">${partnerName}</div>
                                <div class="text-gray" style="font-size: 0.875rem;">${formatDate(receipt.date)}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #8b5cf6;">
                                    ${receipt.quantity}kg
                                </div>
                                <button class="delete-btn" onclick="deleteReceipt('${receipt.id}')" title="ì…ê³  ì‚­ì œ">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                        ${receipt.memo ? `<div style="padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.875rem;">${receipt.memo}</div>` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // ê±°ë˜ì²˜ë³„ ì „ì²´ ë‚´ì—­ ë¡œë“œ
        function loadPartnerHistory() {
            const partnerId = document.getElementById('historyPartnerSelect').value;
            const periodFilter = document.getElementById('historyPeriodFilter').value;
            const container = document.getElementById('partnerHistoryList');
            
            if (!partnerId) {
                container.innerHTML = '<div class="no-history">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ë©´ ì „ì²´ ê±°ë˜ ë‚´ì—­ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>';
                return;
            }
            
            const partner = partners.find(p => p.id === partnerId);
            if (!partner) {
                container.innerHTML = '<div class="text-center text-gray">ì„ íƒí•œ ê±°ë˜ì²˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            // ëª¨ë“  ê±°ë˜ ë‚´ì—­ ìˆ˜ì§‘
            const allTransactions = [];
            
            // ì„ ì£¼ë¬¸ ì¶”ê°€
            orders.filter(o => o.partnerId === partnerId).forEach(order => {
                allTransactions.push({
                    type: 'order',
                    date: order.date,
                    data: order,
                    sortDate: new Date(order.date)
                });
            });
            
            // ì™¸ìƒ ì¶”ê°€
            advances.filter(a => a.partnerId === partnerId).forEach(advance => {
                allTransactions.push({
                    type: 'advance',
                    date: advance.date,
                    data: advance,
                    sortDate: new Date(advance.date)
                });
            });
            
            // ì…ê¸ˆ ì¶”ê°€
            payments.filter(p => p.partnerId === partnerId).forEach(payment => {
                allTransactions.push({
                    type: 'payment',
                    date: payment.date,
                    data: payment,
                    sortDate: new Date(payment.date)
                });
            });
            
            // ì…ê³  ì¶”ê°€
            receipts.filter(r => r.partnerId === partnerId).forEach(receipt => {
                allTransactions.push({
                    type: 'receipt',
                    date: receipt.date,
                    data: receipt,
                    sortDate: new Date(receipt.date)
                });
            });
            
            // ê¸°ê°„ í•„í„° ì ìš©
            let filteredTransactions = allTransactions;
            if (periodFilter !== 'all') {
                const days = parseInt(periodFilter);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                filteredTransactions = allTransactions.filter(transaction => transaction.sortDate >= cutoffDate);
            }
            
            // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            filteredTransactions.sort((a, b) => b.sortDate - a.sortDate);
            
            if (filteredTransactions.length === 0) {
                container.innerHTML = '<div class="text-center text-gray">í•´ë‹¹ ê¸°ê°„ì— ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = filteredTransactions.map(transaction => {
                const data = transaction.data;
                
                switch (transaction.type) {
                    case 'order':
                        return `
                            <div class="card" style="margin-bottom: 15px; border-left: 4px solid #3b82f6;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="background: #dbeafe; color: #1d4ed8; padding: 4px 8px; border-radius: 4px; font-size: 0.875rem; font-weight: bold;">ğŸ“¦ ì„ ì£¼ë¬¸</span>
                                    <span class="text-gray" style="font-size: 0.875rem;">${formatDate(data.date)}</span>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px;">
                                    <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                        <div class="text-gray" style="font-size: 0.75rem;">ìˆ˜ëŸ‰</div>
                                        <div style="font-weight: bold;">${data.quantity}kg</div>
                                    </div>
                                    <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                        <div class="text-gray" style="font-size: 0.75rem;">ë‹¨ê°€</div>
                                        <div style="font-weight: bold;">${formatCurrency(data.pricePerKg)}/kg</div>
                                    </div>
                                    <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                        <div class="text-gray" style="font-size: 0.75rem;">ì´ì•¡</div>
                                        <div style="font-weight: bold; color: #3b82f6;">${formatCurrency(data.totalAmount)}</div>
                                    </div>
                                </div>
                                ${data.memo ? `<div style="padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.875rem;">${data.memo}</div>` : ''}
                            </div>
                        `;
                    case 'advance':
                        return `
                            <div class="card" style="margin-bottom: 15px; border-left: 4px solid #f59e0b;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="background: #fef3c7; color: #d97706; padding: 4px 8px; border-radius: 4px; font-size: 0.875rem; font-weight: bold;">ğŸ’³ ì™¸ìƒ</span>
                                    <span class="text-gray" style="font-size: 0.875rem;">${formatDate(data.date)}</span>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px;">
                                    <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                        <div class="text-gray" style="font-size: 0.75rem;">ìˆ˜ëŸ‰</div>
                                        <div style="font-weight: bold;">${data.quantity}kg</div>
                                    </div>
                                    <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                        <div class="text-gray" style="font-size: 0.75rem;">ë‹¨ê°€</div>
                                        <div style="font-weight: bold;">${formatCurrency(data.pricePerKg)}/kg</div>
                                    </div>
                                    <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                        <div class="text-gray" style="font-size: 0.75rem;">ì´ì•¡</div>
                                        <div style="font-weight: bold; color: #f59e0b;">${formatCurrency(data.totalAmount)}</div>
                                    </div>
                                </div>
                                ${data.memo ? `<div style="padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.875rem;">${data.memo}</div>` : ''}
                            </div>
                        `;
                    case 'payment':
                        let paymentTypeText = '';
                        switch(data.paymentType) {
                            case 'auto': paymentTypeText = 'ğŸ”„ ìë™ì •ì‚°'; break;
                            case 'advance': paymentTypeText = 'ğŸ’³ ì™¸ìƒì •ì‚°'; break;
                            case 'order': paymentTypeText = 'ğŸ“¦ ì„ ì£¼ë¬¸ì •ì‚°'; break;
                            case 'custom': paymentTypeText = 'âœï¸ ì§ì ‘ì§€ì •'; break;
                            default: paymentTypeText = 'ğŸ”„ ìë™ì •ì‚°'; break;
                        }
                        
                        let settlementInfo = '';
                        if (data.advancePayment !== undefined && data.orderPayment !== undefined) {
                            settlementInfo = `
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px;">
                                    <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                        <div class="text-gray" style="font-size: 0.75rem;">ì™¸ìƒ ì •ì‚°</div>
                                        <div style="font-weight: bold;">${formatCurrency(data.advancePayment)}</div>
                                    </div>
                                    <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                        <div class="text-gray" style="font-size: 0.75rem;">ì„ ì£¼ë¬¸ ì •ì‚°</div>
                                        <div style="font-weight: bold;">${formatCurrency(data.orderPayment)}</div>
                                    </div>
                                    <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                                        <div class="text-gray" style="font-size: 0.75rem;">ì´ ì…ê¸ˆì•¡</div>
                                        <div style="font-weight: bold; color: #10b981;">${formatCurrency(data.amount)}</div>
                                    </div>
                                </div>
                            `;
                        } else {
                            settlementInfo = `
                                <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px; margin-bottom: 10px;">
                                    <div class="text-gray" style="font-size: 0.75rem;">ì…ê¸ˆì•¡</div>
                                    <div style="font-weight: bold; color: #10b981;">${formatCurrency(data.amount)}</div>
                                </div>
                            `;
                        }
                        
                        return `
                            <div class="card" style="margin-bottom: 15px; border-left: 4px solid #10b981;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 4px; font-size: 0.875rem; font-weight: bold;">ğŸ’° ì…ê¸ˆ (${paymentTypeText})</span>
                                    <span class="text-gray" style="font-size: 0.875rem;">${formatDate(data.date)}</span>
                                </div>
                                ${settlementInfo}
                                ${data.memo ? `<div style="padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.875rem;">${data.memo}</div>` : ''}
                            </div>
                        `;
                    case 'receipt':
                        return `
                            <div class="card" style="margin-bottom: 15px; border-left: 4px solid #8b5cf6;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="background: #ede9fe; color: #7c3aed; padding: 4px 8px; border-radius: 4px; font-size: 0.875rem; font-weight: bold;">ğŸ“¥ ì…ê³ </span>
                                    <span class="text-gray" style="font-size: 0.875rem;">${formatDate(data.date)}</span>
                                </div>
                                <div style="text-align: center; padding: 8px; background: #f3f4f6; border-radius: 4px; margin-bottom: 10px;">
                                    <div class="text-gray" style="font-size: 0.75rem;">ì…ê³ ëŸ‰</div>
                                    <div style="font-weight: bold; color: #8b5cf6;">${data.quantity}kg</div>
                                </div>
                                ${data.memo ? `<div style="padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.875rem;">${data.memo}</div>` : ''}
                            </div>
                        `;
                }
            }).join('');
        }
        
        // ë‚´ì—­ ì‚­ì œ í•¨ìˆ˜ë“¤ë„ ì¶”ê°€ (í•„ìš”ì‹œ)
        function deletePayment(paymentId) {
            if (confirm('ì´ ì…ê¸ˆ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€» ì‚­ì œí•˜ë©´ ì •ì‚° ë‚´ì—­ë„ ì·¨ì†Œë©ë‹ˆë‹¤.')) {
                payments = payments.filter(p => p.id !== paymentId);
                calculatePartnerStatus();
                saveData();
                updateDashboard();
                loadPaymentHistory();
                alert('ì…ê¸ˆ ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function deleteOrder(orderId) {
            if (confirm('ì´ ì„ ì£¼ë¬¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                orders = orders.filter(o => o.id !== orderId);
                calculatePartnerStatus();
                saveData();
                updateDashboard();
                loadOrderHistory();
                alert('ì„ ì£¼ë¬¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function deleteAdvance(advanceId) {
            if (confirm('ì´ ì™¸ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                advances = advances.filter(a => a.id !== advanceId);
                calculatePartnerStatus();
                saveData();
                updateDashboard();
                loadAdvanceHistory();
                alert('ì™¸ìƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function deleteReceipt(receiptId) {
            if (confirm('ì´ ì…ê³  ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                receipts = receipts.filter(r => r.id !== receiptId);
                calculatePartnerStatus();
                saveData();
                updateDashboard();
                loadReceiptHistory();
                alert('ì…ê³  ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê±°ë˜ë‚´ì—­í™•ì¸ ì´ˆê¸°í™”
        function initializeDataView() {
            updateDataViewSelects();
            filterData();
        }

        // ê±°ë˜ë‚´ì—­í™•ì¸ ì…€ë ‰íŠ¸ ì—…ë°ì´íŠ¸
        function updateDataViewSelects() {
            const partnerSelect = document.getElementById('dataPartnerFilter');
            partnerSelect.innerHTML = '<option value="">ì „ì²´ ê±°ë˜ì²˜</option>';
            
            partners.forEach(partner => {
                const option = document.createElement('option');
                option.value = partner.id;
                option.textContent = partner.name;
                partnerSelect.appendChild(option);
            });
        }

        // ë°ì´í„° í•„í„°ë§
        function filterData() {
            const dataType = document.getElementById('dataTypeFilter').value;
            const partnerId = document.getElementById('dataPartnerFilter').value;
            const startDate = document.getElementById('dataStartDate').value;
            const endDate = document.getElementById('dataEndDate').value;

            let filteredData = [];

            // ë°ì´í„° ìœ í˜•ë³„ë¡œ í•„í„°ë§
            if (dataType === 'all' || dataType === 'partners') {
                let partnerData = partners.filter(p => !partnerId || p.id === partnerId);
                filteredData.push({
                    type: 'partners',
                    title: 'ê±°ë˜ì²˜ ì •ë³´',
                    data: partnerData
                });
            }

            if (dataType === 'all' || dataType === 'orders') {
                let orderData = orders.filter(order => {
                    const matchPartner = !partnerId || order.partnerId === partnerId;
                    const matchDate = (!startDate || order.date >= startDate) && 
                                    (!endDate || order.date <= endDate);
                    return matchPartner && matchDate;
                });
                filteredData.push({
                    type: 'orders',
                    title: 'ì„ ì£¼ë¬¸ ë‚´ì—­',
                    data: orderData
                });
            }

            if (dataType === 'all' || dataType === 'advances') {
                let advanceData = advances.filter(advance => {
                    const matchPartner = !partnerId || advance.partnerId === partnerId;
                    const matchDate = (!startDate || advance.date >= startDate) && 
                                    (!endDate || advance.date <= endDate);
                    return matchPartner && matchDate;
                });
                filteredData.push({
                    type: 'advances',
                    title: 'ì™¸ìƒ ë‚´ì—­',
                    data: advanceData
                });
            }

            if (dataType === 'all' || dataType === 'payments') {
                let paymentData = payments.filter(payment => {
                    const matchPartner = !partnerId || payment.partnerId === partnerId;
                    const matchDate = (!startDate || payment.date >= startDate) && 
                                    (!endDate || payment.date <= endDate);
                    return matchPartner && matchDate;
                });
                filteredData.push({
                    type: 'payments',
                    title: 'ì…ê¸ˆ ë‚´ì—­',
                    data: paymentData
                });
            }

            if (dataType === 'all' || dataType === 'receipts') {
                let receiptData = receipts.filter(receipt => {
                    const matchPartner = !partnerId || receipt.partnerId === partnerId;
                    const matchDate = (!startDate || receipt.date >= startDate) && 
                                    (!endDate || receipt.date <= endDate);
                    return matchPartner && matchDate;
                });
                filteredData.push({
                    type: 'receipts',
                    title: 'ì…ê³  ë‚´ì—­',
                    data: receiptData
                });
            }

            displayFilteredData(filteredData);
        }

        // í•„í„°ëœ ë°ì´í„° í‘œì‹œ
        function displayFilteredData(filteredData) {
            const container = document.getElementById('dataViewContainer');
            
            if (filteredData.every(section => section.data.length === 0)) {
                container.innerHTML = '<div class="card"><p style="text-align: center; color: #666;">ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                return;
            }

            let html = '';

            filteredData.forEach(section => {
                if (section.data.length > 0) {
                    html += `<div class="card" style="margin-bottom: 20px;">`;
                    html += `<h4 style="margin-bottom: 15px;">${section.title} (${section.data.length}ê±´)</h4>`;
                    
                    if (section.type === 'partners') {
                        html += displayPartnersData(section.data);
                    } else if (section.type === 'orders') {
                        html += displayOrdersData(section.data);
                    } else if (section.type === 'advances') {
                        html += displayAdvancesData(section.data);
                    } else if (section.type === 'payments') {
                        html += displayPaymentsData(section.data);
                    } else if (section.type === 'receipts') {
                        html += displayReceiptsData(section.data);
                    }
                    
                    html += `</div>`;
                }
            });

            container.innerHTML = html;
        }

        // ê±°ë˜ì²˜ ë°ì´í„° í‘œì‹œ
        function displayPartnersData(data) {
            return data.map(partner => {
                const status = partnerStatus.get(partner.id) || {
                    pending_payment_order: 0,
                    pending_payment_advance: 0,
                    pending_eel_kg: 0
                };
                return `
                    <div class="data-item" data-type="partners" data-id="${partner.id}" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; align-items: center;">
                            <div>
                                <strong><span class="partner-name-clickable" onclick="filterByPartner('${partner.id}', '${partner.name}')" style="cursor: pointer; color: #2563eb; text-decoration: underline;">${partner.name}</span></strong><br>
                                <small style="color: #666;">${partner.contact || 'ì—°ë½ì²˜ ì—†ìŒ'}</small>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #dc2626;">ì„ ì£¼ë¬¸: ${formatCurrency(status.pending_payment_order)}</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #ea580c;">ì™¸ìƒ: ${formatCurrency(status.pending_payment_advance)}</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #7c3aed;">ë°›ì„ì¥ì–´: ${status.pending_eel_kg}kg</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ì„ ì£¼ë¬¸ ë°ì´í„° í‘œì‹œ
        function displayOrdersData(data) {
            return data.map(order => {
                const partner = partners.find(p => p.id === order.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                return `
                    <div class="data-item" data-type="orders" data-id="${order.id}" style="border: 1px solid #3b82f6; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 10px; align-items: center;">
                            <div><strong><span class="partner-name-clickable" onclick="filterByPartnerName('${partnerName}')" style="cursor: pointer; color: #2563eb; text-decoration: underline;">${partnerName}</span></strong></div>
                            <div style="text-align: center;">${order.date}</div>
                            <div style="text-align: center;">${order.quantity}kg</div>
                            <div style="text-align: center;">${formatCurrency(order.pricePerKg)}/kg</div>
                            <div style="text-align: center;"><strong>${formatCurrency(order.totalAmount)}</strong></div>
                        </div>
                        ${order.memo ? `<div style="margin-top: 10px; color: #666; font-size: 0.9em;">ë©”ëª¨: ${order.memo}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // ì™¸ìƒ ë°ì´í„° í‘œì‹œ
        function displayAdvancesData(data) {
            return data.map(advance => {
                const partner = partners.find(p => p.id === advance.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                return `
                    <div class="data-item" data-type="advances" data-id="${advance.id}" style="border: 1px solid #f59e0b; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 10px; align-items: center;">
                            <div><strong><span class="partner-name-clickable" onclick="filterByPartnerName('${partnerName}')" style="cursor: pointer; color: #2563eb; text-decoration: underline;">${partnerName}</span></strong></div>
                            <div style="text-align: center;">${advance.date}</div>
                            <div style="text-align: center;">${advance.quantity}kg</div>
                            <div style="text-align: center;">${formatCurrency(advance.pricePerKg)}/kg</div>
                            <div style="text-align: center;"><strong>${formatCurrency(advance.totalAmount)}</strong></div>
                        </div>
                        ${advance.memo ? `<div style="margin-top: 10px; color: #666; font-size: 0.9em;">ë©”ëª¨: ${advance.memo}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // ì…ê¸ˆ ë°ì´í„° í‘œì‹œ
        function displayPaymentsData(data) {
            return data.map(payment => {
                const partner = partners.find(p => p.id === payment.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                return `
                    <div class="data-item" data-type="payments" data-id="${payment.id}" style="border: 1px solid #10b981; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; align-items: center;">
                            <div><strong><span class="partner-name-clickable" onclick="filterByPartnerName('${partnerName}')" style="cursor: pointer; color: #2563eb; text-decoration: underline;">${partnerName}</span></strong></div>
                            <div style="text-align: center;">${payment.date}</div>
                            <div style="text-align: center;"><strong>${formatCurrency(payment.amount)}</strong></div>
                        </div>
                        ${payment.memo ? `<div style="margin-top: 10px; color: #666; font-size: 0.9em;">ë©”ëª¨: ${payment.memo}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // ì…ê³  ë°ì´í„° í‘œì‹œ
        function displayReceiptsData(data) {
            return data.map(receipt => {
                const partner = partners.find(p => p.id === receipt.partnerId);
                const partnerName = partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜';
                return `
                    <div class="data-item" data-type="receipts" data-id="${receipt.id}" style="border: 1px solid #8b5cf6; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; align-items: center;">
                            <div><strong><span class="partner-name-clickable" onclick="filterByPartnerName('${partnerName}')" style="cursor: pointer; color: #2563eb; text-decoration: underline;">${partnerName}</span></strong></div>
                            <div style="text-align: center;">${receipt.date}</div>
                            <div style="text-align: center;"><strong>${receipt.quantity}kg</strong></div>
                        </div>
                        ${receipt.memo ? `<div style="margin-top: 10px; color: #666; font-size: 0.9em;">ë©”ëª¨: ${receipt.memo}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // í•„í„°ëœ ë°ì´í„° ì¶œë ¥
        function exportFilteredData() {
            const dataType = document.getElementById('dataTypeFilter').value;
            const partnerId = document.getElementById('dataPartnerFilter').value;
            const startDate = document.getElementById('dataStartDate').value;
            const endDate = document.getElementById('dataEndDate').value;

            let filteredData = {};
            let filterInfo = [];

            // í•„í„° ì •ë³´ ìƒì„±
            if (partnerId) {
                const partner = partners.find(p => p.id === partnerId);
                filterInfo.push(`ê±°ë˜ì²˜: ${partner ? partner.name : 'ì•Œ ìˆ˜ ì—†ìŒ'}`);
            }
            if (startDate) filterInfo.push(`ì‹œì‘ì¼: ${startDate}`);
            if (endDate) filterInfo.push(`ì¢…ë£Œì¼: ${endDate}`);

            // ë°ì´í„° í•„í„°ë§
            if (dataType === 'all' || dataType === 'partners') {
                filteredData['ê±°ë˜ì²˜'] = partners.filter(p => !partnerId || p.id === partnerId);
            }
            if (dataType === 'all' || dataType === 'orders') {
                filteredData['ì„ ì£¼ë¬¸'] = orders.filter(order => {
                    const matchPartner = !partnerId || order.partnerId === partnerId;
                    const matchDate = (!startDate || order.date >= startDate) && (!endDate || order.date <= endDate);
                    return matchPartner && matchDate;
                });
            }
            if (dataType === 'all' || dataType === 'advances') {
                filteredData['ì™¸ìƒ'] = advances.filter(advance => {
                    const matchPartner = !partnerId || advance.partnerId === partnerId;
                    const matchDate = (!startDate || advance.date >= startDate) && (!endDate || advance.date <= endDate);
                    return matchPartner && matchDate;
                });
            }
            if (dataType === 'all' || dataType === 'payments') {
                filteredData['ì…ê¸ˆ'] = payments.filter(payment => {
                    const matchPartner = !partnerId || payment.partnerId === partnerId;
                    const matchDate = (!startDate || payment.date >= startDate) && (!endDate || payment.date <= endDate);
                    return matchPartner && matchDate;
                });
            }
            if (dataType === 'all' || dataType === 'receipts') {
                filteredData['ì…ê³ '] = receipts.filter(receipt => {
                    const matchPartner = !partnerId || receipt.partnerId === partnerId;
                    const matchDate = (!startDate || receipt.date >= startDate) && (!endDate || receipt.date <= endDate);
                    return matchPartner && matchDate;
                });
            }

            const title = `í•„í„°ëœ ê±°ë˜ ë°ì´í„°${filterInfo.length > 0 ? ' (' + filterInfo.join(', ') + ')' : ''}`;
            printData(title, filteredData);
        }

        // ê±°ë˜ì²˜ IDë¡œ í•„í„°ë§
        function filterByPartner(partnerId, partnerName) {
            // ê±°ë˜ì²˜ í•„í„° ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì—…ë°ì´íŠ¸
            document.getElementById('dataPartnerFilter').value = partnerId;
            
            // í•„í„° ì ìš©
            filterData();
            
            // ì‹œê°ì  í”¼ë“œë°± ì œê³µ
            showFilterNotification(partnerName);
        }

        // ê±°ë˜ì²˜ ì´ë¦„ìœ¼ë¡œ í•„í„°ë§ (ì´ë¦„ìœ¼ë¡œ ID ì°¾ì•„ì„œ í•„í„°ë§)
        function filterByPartnerName(partnerName) {
            const partner = partners.find(p => p.name === partnerName);
            if (partner) {
                filterByPartner(partner.id, partnerName);
            } else {
                // ì‚­ì œëœ ê±°ë˜ì²˜ì˜ ê²½ìš° ìˆ˜ë™ìœ¼ë¡œ í•„í„°ë§
                document.getElementById('dataPartnerFilter').value = '';
                manualFilterByPartnerName(partnerName);
            }
        }

        // ì‚­ì œëœ ê±°ë˜ì²˜ë¥¼ ìœ„í•œ ìˆ˜ë™ í•„í„°ë§
        function manualFilterByPartnerName(partnerName) {
            const dataItems = document.querySelectorAll('.data-item');
            
            dataItems.forEach(item => {
                const partnerNameElement = item.querySelector('.partner-name-clickable');
                if (partnerNameElement) {
                    const itemPartnerName = partnerNameElement.textContent;
                    if (itemPartnerName === partnerName) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                } else {
                    item.style.display = 'none';
                }
            });
            
            showFilterNotification(partnerName + ' (ì‚­ì œëœ ê±°ë˜ì²˜)');
        }

        // í•„í„° ì•Œë¦¼ í‘œì‹œ
        function showFilterNotification(partnerName) {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existingNotification = document.getElementById('filterNotification');
            if (existingNotification) {
                existingNotification.remove();
            }

            // ìƒˆ ì•Œë¦¼ ìƒì„±
            const notification = document.createElement('div');
            notification.id = 'filterNotification';
            notification.innerHTML = `
                <div style="background: #3b82f6; color: white; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ“‹ "${partnerName}" ê±°ë˜ì²˜ë¡œ í•„í„°ë§ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
                    <button onclick="clearPartnerFilter()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer;">ì „ì²´ ë³´ê¸°</button>
                </div>
            `;
            
            // ë°ì´í„° ì»¨í…Œì´ë„ˆ ìœ„ì— ì‚½ì…
            const container = document.getElementById('dataViewContainer');
            container.parentNode.insertBefore(notification, container);
        }

        // ê±°ë˜ì²˜ í•„í„° í•´ì œ
        function clearPartnerFilter() {
            // í•„í„° ì´ˆê¸°í™”
            document.getElementById('dataPartnerFilter').value = '';
            
            // ë°ì´í„° ë‹¤ì‹œ í•„í„°ë§
            filterData();
            
            // ì•Œë¦¼ ì œê±°
            const notification = document.getElementById('filterNotification');
            if (notification) {
                notification.remove();
            }
        }

        // ë°ì´í„° ì¶œë ¥ í•¨ìˆ˜
        function printData(title, data) {
            const printWindow = window.open('', '_blank');
            let html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #333; border-bottom: 2px solid #333; padding-bottom: 10px; }
                        h2 { color: #666; margin-top: 30px; }
                        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f5f5f5; font-weight: bold; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        .print-date { text-align: right; color: #666; margin-bottom: 20px; }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-date">ì¶œë ¥ì¼: ${new Date().toLocaleDateString('ko-KR')}</div>
                    <h1>${title}</h1>
            `;

            Object.entries(data).forEach(([category, items]) => {
                if (items && items.length > 0) {
                    html += `<h2>${category} (${items.length}ê±´)</h2>`;
                    html += '<table>';
                    
                    if (category === 'ê±°ë˜ì²˜') {
                        html += '<tr><th>ê±°ë˜ì²˜ëª…</th><th>ì—°ë½ì²˜</th><th>ë“±ë¡ì¼</th></tr>';
                        items.forEach(item => {
                            html += `<tr>
                                <td>${item.name}</td>
                                <td>${item.contact || 'ì—†ìŒ'}</td>
                                <td>${formatDate(item.createdAt)}</td>
                            </tr>`;
                        });
                    } else if (category === 'ì„ ì£¼ë¬¸') {
                        html += '<tr><th>ê±°ë˜ì²˜</th><th>ë‚ ì§œ</th><th>ìˆ˜ëŸ‰(kg)</th><th>ë‹¨ê°€</th><th>ì´ì•¡</th><th>ë©”ëª¨</th></tr>';
                        items.forEach(item => {
                            const partner = partners.find(p => p.id === item.partnerId);
                            html += `<tr>
                                <td>${partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜'}</td>
                                <td>${item.date}</td>
                                <td>${item.quantity}</td>
                                <td>${formatCurrency(item.pricePerKg)}</td>
                                <td>${formatCurrency(item.totalAmount)}</td>
                                <td>${item.memo || ''}</td>
                            </tr>`;
                        });
                    } else if (category === 'ì™¸ìƒ') {
                        html += '<tr><th>ê±°ë˜ì²˜</th><th>ë‚ ì§œ</th><th>ìˆ˜ëŸ‰(kg)</th><th>ë‹¨ê°€</th><th>ì´ì•¡</th><th>ë©”ëª¨</th></tr>';
                        items.forEach(item => {
                            const partner = partners.find(p => p.id === item.partnerId);
                            html += `<tr>
                                <td>${partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜'}</td>
                                <td>${item.date}</td>
                                <td>${item.quantity}</td>
                                <td>${formatCurrency(item.pricePerKg)}</td>
                                <td>${formatCurrency(item.totalAmount)}</td>
                                <td>${item.memo || ''}</td>
                            </tr>`;
                        });
                    } else if (category === 'ì…ê¸ˆ') {
                        html += '<tr><th>ê±°ë˜ì²˜</th><th>ë‚ ì§œ</th><th>ì…ê¸ˆì•¡</th><th>ë©”ëª¨</th></tr>';
                        items.forEach(item => {
                            const partner = partners.find(p => p.id === item.partnerId);
                            html += `<tr>
                                <td>${partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜'}</td>
                                <td>${item.date}</td>
                                <td>${formatCurrency(item.amount)}</td>
                                <td>${item.memo || ''}</td>
                            </tr>`;
                        });
                    } else if (category === 'ì…ê³ ') {
                        html += '<tr><th>ê±°ë˜ì²˜</th><th>ë‚ ì§œ</th><th>ìˆ˜ëŸ‰(kg)</th><th>ë©”ëª¨</th></tr>';
                        items.forEach(item => {
                            const partner = partners.find(p => p.id === item.partnerId);
                            html += `<tr>
                                <td>${partner ? partner.name : 'ì‚­ì œëœ ê±°ë˜ì²˜'}</td>
                                <td>${item.date}</td>
                                <td>${item.quantity}</td>
                                <td>${item.memo || ''}</td>
                            </tr>`;
                        });
                    }
                    
                    html += '</table>';
                }
            });

            html += `
                    <div style="margin-top: 30px; text-align: center;" class="no-print">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">ì¸ì‡„</button>
                        <button onclick="window.close()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">ë‹«ê¸°</button>
                    </div>
                </body>
                </html>
            `;

            printWindow.document.write(html);
            printWindow.document.close();
        }
    </script>
</body>
</html>